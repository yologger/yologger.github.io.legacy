
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Yologger&#39;s Blog">
    <title>아카이브 - Yologger&#39;s Blog</title>
    <meta name="author" content="yologger">
    
    
        <link rel="icon" href="https://yologger.github.io/ko/assets/images/favicon.png">
    
    
    <script type="application/ld+json">{}</script>
    <meta name="description" content="Yologger&#39;s Blog">
<meta property="og:type" content="blog">
<meta property="og:title" content="Yologger&#39;s Blog">
<meta property="og:url" content="https://yologger.github.io/ko/archives/page/8/index.html">
<meta property="og:site_name" content="Yologger&#39;s Blog">
<meta property="og:description" content="Yologger&#39;s Blog">
<meta property="og:locale" content="ko_KR">
<meta property="article:author" content="yologger">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/ko/assets/css/style-mg0ufdhe3lf13uaqzh5sfd3dtbhx3iokplil152c5hqau8lqr315qgpxsjvw.min.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QYKNWR810R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-QYKNWR810R');
    </script>


    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/ko/"
            aria-label=""
        >
            Yologger&#39;s Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /ko/#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://yologger.github.io"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="English"
                        >
                        <i class="sidebar-button-icon fa fa-globe" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">English</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/yologger"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/mailto"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/java"
                            
                            rel="noopener"
                            title="Java"
                        >
                        <i class="sidebar-button-icon fab fa-java" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Java</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/kotlin"
                            
                            rel="noopener"
                            title="Kotlin"
                        >
                        <i class="sidebar-button-icon fab fa-korvue" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Kotlin</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/android"
                            
                            rel="noopener"
                            title="Android"
                        >
                        <i class="sidebar-button-icon fab fa-android" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Android</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/spring"
                            
                            rel="noopener"
                            title="Spring"
                        >
                        <i class="sidebar-button-icon fas fa-leaf" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Spring</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/devops"
                            
                            rel="noopener"
                            title="DevOps"
                        >
                        <i class="sidebar-button-icon fa fa-cogs" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">DevOps</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/tools"
                            
                            rel="noopener"
                            title="Tools"
                        >
                        <i class="sidebar-button-icon fa fa-wrench" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tools</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/ko/algorithm"
                            
                            rel="noopener"
                            title="Algorithm"
                        >
                        <i class="sidebar-button-icon fas fa-project-diagram" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Algorithm</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/ko/2019/07/06/08_android/01_android_platform/190706_content_provider/"
                            aria-label=": [Android] 컨텐트 프로바이더(Content Provider)와 컨텐트 리솔버(Content Resolver)"
                        >
                            [Android] 컨텐트 프로바이더(Content Provider)와 컨텐트 리솔버(Content Resolver)
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-07-06T01:00:00+09:00">
	
		    2019/07/06
    	
    </time>
    
        <span>카테고리 </span>
        
    <a class="category-link" href="/ko/categories/Android/">Android</a>, <a class="category-link" href="/ko/categories/Android/Android-Platform/">Android Platform</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <hr>
<h1 id="컨텐트-프로바이더와-컨텐트-리솔버"><a href="#컨텐트-프로바이더와-컨텐트-리솔버" class="headerlink" title="컨텐트 프로바이더와 컨텐트 리솔버"></a>컨텐트 프로바이더와 컨텐트 리솔버</h1><p>다음과 같이 두 앱이 있다고 가정합시다.<br><img src="1.png"><br><code>컨텐트 프로바이더(Content Provider)</code>와 <code>컨텐트 리솔버(Content Resolver)</code>를 사용하면 다른 어플리캐이션의 데이터에 접근할 수 있습니다. 컨텐트 프로바이더가 정의된 앱을 <code>서버 앱</code>, 컨텐트 리솔버를 사용하는 앱을 <code>클라이언트 앱</code>이라고도 합니다.<br><img src="2.png"><br>데이터를 제공하는 앱에서는 <code>컨텐트 프로바이더</code>를 구현합니다. 데이터를 사용하는 앱에서는 <code>getContentResolver()</code>를 호출하여 <code>컨텐트 리솔버</code> 객체에 접근할 수 있습니다. 이 객체를 사용하여 다른 앱에 데이터를 추가, 변경, 삭제, 조회할 수 있습니다.</p>
<h1 id="예제"><a href="#예제" class="headerlink" title="예제"></a>예제</h1><p>다음과 같은 예제를 만들며 <code>컨텐트 프로바이더</code>와 <code>컨텐트 리솔버</code>에 대해 알아보겠습니다.<br><img src="4.png"><br><code>서버 앱</code>에서는 데이터를 추가, 삭제, 탐색할 수 있습니다. 또한 컨텐트 프로바이더도 구현되어있습니다. </p>
<p><code>클라이언트 앱</code>은 버튼을 누르면 컨텐트 리솔버를 사용하여 데이터를 조회합니다. 이후 토스트 메시지로 조회한 데이터의 개수를 보여줍니다.</p>
<hr>
<h1 id="서버-앱"><a href="#서버-앱" class="headerlink" title="서버 앱"></a>서버 앱</h1><blockquote>
<p>컨텐트 프로바이더 예제는 <a href="/ko/2019/07/05/08_android/01_android_platform/190705_sqlite/">SQLite 포스트의 예제</a>를 사용합니다. </p>
</blockquote>
<p>우선 데이터를 제공하는 앱에서 컨텐트 프로바이더를 구현합시다. 컨텐트 프로바이더는 <code>ContentProvider</code>클래스의 서브클래스입니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductContentProvider</span> : <span class="type">ContentProvider</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">delete</span><span class="params">(uri: <span class="type">Uri</span>, selection: <span class="type">String</span>?, selectionArgs: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;?)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        TODO(<span class="string">&quot;Implement this to handle requests to delete one or more rows&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getType</span><span class="params">(uri: <span class="type">Uri</span>)</span></span>: String? &#123;</span><br><span class="line">        TODO(</span><br><span class="line">            <span class="string">&quot;Implement this to handle requests for the MIME type of the data&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;at the given URI&quot;</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">insert</span><span class="params">(uri: <span class="type">Uri</span>, values: <span class="type">ContentValues</span>?)</span></span>: Uri? &#123;</span><br><span class="line">        TODO(<span class="string">&quot;Implement this to handle requests to insert a new row.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        TODO(<span class="string">&quot;Implement this to initialize your content provider on startup.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">query</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        uri: <span class="type">Uri</span>, projection: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;?, selection: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">        selectionArgs: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;?, sortOrder: <span class="type">String</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: Cursor? &#123;</span><br><span class="line">        TODO(<span class="string">&quot;Implement this to handle query requests from clients.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        uri: <span class="type">Uri</span>, values: <span class="type">ContentValues</span>?, selection: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">        selectionArgs: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;?</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        TODO(<span class="string">&quot;Implement this to handle requests to update one or more rows.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ContentProvider</code>클래스를 구현하면 위와 같이 여섯 개의 메소드를 오버라이딩 해야합니다. </p>
<p>또한 컨텐트 프로바이더는 안드로이드의 4대 컴포넌트 중 하나이므로 <code>AndroidManifest.xml</code>에 선언해야합니다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">&quot;com.yologger.sqlite&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.Sqlite&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">provider</span> <span class="attr">android:name</span>=<span class="string">&quot;.ProductContentProvider&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:authorities</span>=<span class="string">&quot;com.yologger.sqlite.ProductContentProvider&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>이때 컨텐트 프로바이더의 세 가지 속성 값을 지정해야합니다. </p>
<ul>
<li><p><code>enabled</code>: 안드로이드 시스템에 의해 컨텐트 프로바이더의 인스턴스가 생성될 수 있는지 여부입니다. 이 값이 false면 시스템이 컨텐트 프로바이더 인스턴스를 생성할 수 없습니다. 따라서 값을 true로 설정합니다.</p>
</li>
<li><p><code>export</code>: 다른 앱이 컨텐트 프로바이더를 사용할 수 있는지 여부입니다. 이 값이 false면 같은 앱에서만 컨텐트 프로바이더에 접근할 수 있습니다. 따라서 값을 true로 설정합니다.</p>
</li>
<li><p><code>authorities</code>: 다른 앱이 컨텐트 프로바이더에 접근할 때 사용하는 주소입니다.</p>
</li>
</ul>
<p>이제 컨텐트 프로바이더의 메소드를 하나씩 구현해봅시다. </p>
<h3 id="1-authority-URI-상수-정의"><a href="#1-authority-URI-상수-정의" class="headerlink" title="(1) authority, URI 상수 정의"></a>(1) authority, URI 상수 정의</h3><p>모든 컨텐트 프로바이더는 <code>authority</code>와 <code>콘텐트 URI</code>을 가지고 있습니다. <code>authority</code>값은 콘텐트 제공자 클래스 자신의 완전한 패키지 이름을 사용합니다. <code>콘텐트 URI</code>는 앱에 따라 달라질 수 있습니다. 여기서는 데이터베이스 테이블 이름인 product로 구성하겠습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductContentProvider</span> : <span class="type">ContentProvider</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> AUTHORITY = <span class="string">&quot;com.yologger.sqlite.ProductContentProvider&quot;</span></span><br><span class="line">    <span class="keyword">val</span> TABLE_PRODUCTS = <span class="string">&quot;products&quot;</span></span><br><span class="line">    <span class="keyword">val</span> CONTENT_URI  = Uri.parse(<span class="string">&quot;content://<span class="variable">$AUTHORITY</span>/<span class="variable">$TABLE_PRODUCTS</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> URL_MATCH_RESULT_PRODUCT = <span class="number">1</span></span><br><span class="line">    <span class="keyword">val</span> URL_MATCH_RESULT_PRODUCT_ID = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-UriMatcher-구현하기"><a href="#2-UriMatcher-구현하기" class="headerlink" title="(2) UriMatcher 구현하기"></a>(2) UriMatcher 구현하기</h3><p>컨텐트 리솔버는 <a href="/ko/2019/06/15/08_android/01_android_platform/190615_uri_urimatcher/"><code>Uri</code></a>객체를 통해 컨텐트 프로바이더에 접근합니다. 컨텐트 프로바이더에서는 <a href="/ko/2019/06/15/08_android/01_android_platform/190615_uri_urimatcher/"><code>UriMatcher</code></a>를 통해 컨텐트 리솔버를 구분합니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductContentProvider</span> : <span class="type">ContentProvider</span></span>() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> URL_MATCH_RESULT_PRODUCT = <span class="number">1</span></span><br><span class="line">    <span class="keyword">val</span> URL_MATCH_RESULT_PRODUCT_ID = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> uriMatcher = UriMatcher(UriMatcher.NO_MATCH)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        uriMatcher.addURI(AUTHORITY, TABLE_PRODUCTS, URL_MATCH_RESULT_PRODUCT)</span><br><span class="line">        uriMatcher.addURI(AUTHORITY, <span class="string">&quot;<span class="variable">$TABLE_PRODUCTS</span>/#&quot;</span>, URL_MATCH_RESULT_PRODUCT_ID)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-onCreate"><a href="#3-onCreate" class="headerlink" title="(3) onCreate()"></a>(3) onCreate()</h3><p><code>onCreate()</code>에서는 초기화에 필요한 작업을 수행합니다. 여기서는 SQLite 관련 포스트에서 살펴본 <code>SQLiteHelper</code>클래스의 인스턴스와 <code>SQLiteDatabase</code>클래스의 인스턴스를 생성하겠습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductContentProvider</span> : <span class="type">ContentProvider</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> dbHelper: DBHelper</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> db: SQLiteDatabase</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line"></span><br><span class="line">        dbHelper = DBHelper(context!!, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">1</span>)</span><br><span class="line">        db = dbHelper.writableDatabase</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-insert"><a href="#4-insert" class="headerlink" title="(4) insert()"></a>(4) insert()</h3><p>클라이언트 앱이 데이터 추가를 요청하면 콘텐트 프로바이더의 <code>insert()</code>가 호출됩니다. 우선 <code>UriMatcher</code>클래스를 사용하여 적절한 URI가 전달되었는지 확인합니다. 이후 데이터베이스에 값을 추가합니다. 마지막으로 컨텐트 리솔버에 데이터 추가 완료를 통보합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">insert</span><span class="params">(uri: <span class="type">Uri</span>, values: <span class="type">ContentValues</span>?)</span></span>: Uri? &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> uriType = uriMatcher.match(uri)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> id: <span class="built_in">Long</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">when</span>(uriType) &#123;</span><br><span class="line">        URL_MATCH_RESULT_PRODUCT -&gt; &#123;</span><br><span class="line">            <span class="comment">// 데이터베이스에 데이터 추가</span></span><br><span class="line">            id = db.insert(DBHelper.TABLE_PRODUCTS, <span class="literal">null</span>, values)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">            <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Unknown URI: <span class="subst">$&#123;uri&#125;</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 컨텐트 리솔버에 데이터 추가를 알림</span></span><br><span class="line">    requireContext().contentResolver.notifyChange(uri, <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Uri.parse(<span class="string">&quot;TABLE_PRODUCTS/<span class="subst">$&#123;id&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-query"><a href="#5-query" class="headerlink" title="(5) query()"></a>(5) query()</h3><p>클라이언트 앱이 데이터 조회를 요청하면 컨텐트 프로바이더의 <code>query()</code>가 호출됩니다. 우선 <code>UriMatcher</code>클래스를 사용하여 적절한 URI가 전달되었는지 확인합니다. 이후 데이터베이스를 조회하면 <code>Cursor</code>클래스의 인스턴스가 반환됩니다. 이를 <code>query()</code>메소드의 반환값으로 전달합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">query</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    uri: <span class="type">Uri</span>, projection: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;?, selection: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    selectionArgs: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;?, sortOrder: <span class="type">String</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Cursor? &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> uriType = uriMatcher.match(uri)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">when</span> (uriType) &#123;</span><br><span class="line">        URL_MATCH_RESULT_PRODUCT -&gt; &#123;</span><br><span class="line">            <span class="keyword">val</span> query = <span class="string">&quot;SELECT * FROM <span class="subst">$&#123;DBHelper.TABLE_PRODUCTS&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">var</span> cursor = db.rawQuery(query, <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> cursor</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">            <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Unknown URI&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-delete"><a href="#6-delete" class="headerlink" title="(6) delete()"></a>(6) delete()</h3><p>클라이언트 앱이 데이터 삭제를 요청하면 컨텐트 프로바이더의 <code>delete()</code>가 호출됩니다. 우선 <code>UriMatcher</code>클래스를 사용하여 적절한 URI가 전달되었는지 확인합니다. 이후 데이터베이스에서 데이터를 삭제하고, 삭제된 데이터의 개수를 반환합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">delete</span><span class="params">(uri: <span class="type">Uri</span>, selection: <span class="type">String</span>?, selectionArgs: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;?)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> uriType = uriMatcher.match(uri)</span><br><span class="line">    <span class="keyword">var</span> db = dbHelper.writableDatabase</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> rowsDeleted = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">when</span>(uriType) &#123;</span><br><span class="line">        URL_MATCH_RESULT_PRODUCT -&gt; &#123;</span><br><span class="line">            rowsDeleted = db.delete(DBHelper.TABLE_PRODUCTS, selection,  selectionArgs)</span><br><span class="line">        &#125;</span><br><span class="line">        URL_MATCH_RESULT_PRODUCT_ID -&gt; &#123;</span><br><span class="line">            <span class="keyword">var</span> id = uri.lastPathSegment</span><br><span class="line">            <span class="keyword">if</span> (TextUtils.isEmpty(selection)) &#123;</span><br><span class="line">                rowsDeleted = db.delete(DBHelper.TABLE_PRODUCTS, <span class="string">&quot;<span class="subst">$&#123;DBHelper.COLUMN_ID&#125;</span> = <span class="variable">$id</span>&quot;</span>,  <span class="literal">null</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                rowsDeleted = db.delete(DBHelper.TABLE_PRODUCTS, <span class="string">&quot;<span class="subst">$&#123;DBHelper.COLUMN_ID&#125;</span> = <span class="variable">$id</span> and <span class="variable">$selection</span>&quot;</span>,  selectionArgs)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">            <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Unknown URI: <span class="subst">$&#123;uri&#125;</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    requireContext().contentResolver.notifyChange(uri, <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> rowsDeleted</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-update"><a href="#7-update" class="headerlink" title="(7) update()"></a>(7) update()</h3><p>클라이언트 앱이 데이터 변경를 요청하면 컨텐트 프로바이더의 <code>update()</code>가 호출됩니다. 우선 <code>UriMatcher</code>클래스를 사용하여 적절한 URI가 전달되었는지 확인합니다. 이후 데이터베이스의 데이터를 변경하고, 변경된 데이터의 개수를 반환합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    uri: <span class="type">Uri</span>, values: <span class="type">ContentValues</span>?, selection: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">    selectionArgs: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;?</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> uriType = uriMatcher.match(uri)</span><br><span class="line">    <span class="keyword">var</span> db = dbHelper.writableDatabase</span><br><span class="line">    <span class="keyword">var</span> rowsUpdated = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">when</span>(uriType) &#123;</span><br><span class="line">        URL_MATCH_RESULT_PRODUCT -&gt; &#123;</span><br><span class="line">            rowsUpdated = db.update(DBHelper.TABLE_PRODUCTS, values,  selection, selectionArgs)</span><br><span class="line">        &#125;</span><br><span class="line">        URL_MATCH_RESULT_PRODUCT_ID -&gt; &#123;</span><br><span class="line">            <span class="keyword">var</span> id = uri.lastPathSegment</span><br><span class="line">            <span class="keyword">if</span> (TextUtils.isEmpty(selection)) &#123;</span><br><span class="line">                rowsUpdated = db.update(DBHelper.TABLE_PRODUCTS, values,  <span class="string">&quot;DBHelper.COLUMN_ID = <span class="variable">$id</span>&quot;</span>, <span class="literal">null</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                rowsUpdated = db.update(DBHelper.TABLE_PRODUCTS, values,  <span class="string">&quot;DBHelper.COLUMN_ID = <span class="variable">$id</span> and <span class="variable">$selection</span>&quot;</span>, selectionArgs)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">            <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Unknown URI: <span class="subst">$&#123;uri&#125;</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    requireContext().contentResolver.notifyChange(uri, <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> rowsUpdated</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-컨텐트-프로바이더의-전체-코드"><a href="#8-컨텐트-프로바이더의-전체-코드" class="headerlink" title="(8) 컨텐트 프로바이더의 전체 코드"></a>(8) 컨텐트 프로바이더의 전체 코드</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductContentProvider</span> : <span class="type">ContentProvider</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> AUTHORITY = <span class="string">&quot;com.yologger.sqlite.ProductContentProvider&quot;</span></span><br><span class="line">    <span class="keyword">val</span> TABLE_PRODUCTS = <span class="string">&quot;products&quot;</span></span><br><span class="line">    <span class="keyword">val</span> CONTENT_URI  = Uri.parse(<span class="string">&quot;content://<span class="variable">$AUTHORITY</span>/<span class="variable">$TABLE_PRODUCTS</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> URL_MATCH_RESULT_PRODUCT = <span class="number">1</span></span><br><span class="line">    <span class="keyword">val</span> URL_MATCH_RESULT_PRODUCT_ID = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> uriMatcher = UriMatcher(UriMatcher.NO_MATCH)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        uriMatcher.addURI(AUTHORITY, TABLE_PRODUCTS, URL_MATCH_RESULT_PRODUCT)</span><br><span class="line">        uriMatcher.addURI(AUTHORITY, <span class="string">&quot;<span class="variable">$TABLE_PRODUCTS</span>/#&quot;</span>, URL_MATCH_RESULT_PRODUCT_ID)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> dbHelper: DBHelper</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> db: SQLiteDatabase</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line"></span><br><span class="line">        dbHelper = DBHelper(context!!, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">1</span>)</span><br><span class="line">        db = dbHelper.writableDatabase</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">insert</span><span class="params">(uri: <span class="type">Uri</span>, values: <span class="type">ContentValues</span>?)</span></span>: Uri? &#123;</span><br><span class="line">        <span class="keyword">var</span> uriType = uriMatcher.match(uri)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> id: <span class="built_in">Long</span> = <span class="number">0</span></span><br><span class="line">        <span class="keyword">when</span>(uriType) &#123;</span><br><span class="line">            URL_MATCH_RESULT_PRODUCT -&gt; &#123;</span><br><span class="line">                id = db.insert(DBHelper.TABLE_PRODUCTS, <span class="literal">null</span>, values)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">                <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Unknown URI: <span class="subst">$&#123;uri&#125;</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        requireContext().contentResolver.notifyChange(uri, <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> Uri.parse(<span class="string">&quot;TABLE_PRODUCTS/<span class="subst">$&#123;id&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">query</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        uri: <span class="type">Uri</span>, projection: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;?, selection: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">        selectionArgs: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;?, sortOrder: <span class="type">String</span>?</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: Cursor? &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> uriType = uriMatcher.match(uri)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">when</span> (uriType) &#123;</span><br><span class="line">            URL_MATCH_RESULT_PRODUCT -&gt; &#123;</span><br><span class="line">                <span class="keyword">val</span> query = <span class="string">&quot;SELECT * FROM <span class="subst">$&#123;DBHelper.TABLE_PRODUCTS&#125;</span>&quot;</span></span><br><span class="line">                <span class="keyword">var</span> cursor = db.rawQuery(query, <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> cursor</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">                <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Unknown URI&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        uri: <span class="type">Uri</span>, values: <span class="type">ContentValues</span>?, selection: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">        selectionArgs: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;?</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> uriType = uriMatcher.match(uri)</span><br><span class="line">        <span class="keyword">var</span> db = dbHelper.writableDatabase</span><br><span class="line">        <span class="keyword">var</span> rowsUpdated = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">when</span>(uriType) &#123;</span><br><span class="line">            URL_MATCH_RESULT_PRODUCT -&gt; &#123;</span><br><span class="line">                rowsUpdated = db.update(DBHelper.TABLE_PRODUCTS, values,  selection, selectionArgs)</span><br><span class="line">            &#125;</span><br><span class="line">            URL_MATCH_RESULT_PRODUCT_ID -&gt; &#123;</span><br><span class="line">                <span class="keyword">var</span> id = uri.lastPathSegment</span><br><span class="line">                <span class="keyword">if</span> (TextUtils.isEmpty(selection)) &#123;</span><br><span class="line">                    rowsUpdated = db.update(DBHelper.TABLE_PRODUCTS, values,  <span class="string">&quot;DBHelper.COLUMN_ID = <span class="variable">$id</span>&quot;</span>, <span class="literal">null</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    rowsUpdated = db.update(DBHelper.TABLE_PRODUCTS, values,  <span class="string">&quot;DBHelper.COLUMN_ID = <span class="variable">$id</span> and <span class="variable">$selection</span>&quot;</span>, selectionArgs)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">                <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Unknown URI: <span class="subst">$&#123;uri&#125;</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        requireContext().contentResolver.notifyChange(uri, <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> rowsUpdated</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">delete</span><span class="params">(uri: <span class="type">Uri</span>, selection: <span class="type">String</span>?, selectionArgs: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;?)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> uriType = uriMatcher.match(uri)</span><br><span class="line">        <span class="keyword">var</span> db = dbHelper.writableDatabase</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> rowsDeleted = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">when</span>(uriType) &#123;</span><br><span class="line">            URL_MATCH_RESULT_PRODUCT -&gt; &#123;</span><br><span class="line">                rowsDeleted = db.delete(DBHelper.TABLE_PRODUCTS, selection,  selectionArgs)</span><br><span class="line">            &#125;</span><br><span class="line">            URL_MATCH_RESULT_PRODUCT_ID -&gt; &#123;</span><br><span class="line">                <span class="keyword">var</span> id = uri.lastPathSegment</span><br><span class="line">                <span class="keyword">if</span> (TextUtils.isEmpty(selection)) &#123;</span><br><span class="line">                    rowsDeleted = db.delete(DBHelper.TABLE_PRODUCTS, <span class="string">&quot;<span class="subst">$&#123;DBHelper.COLUMN_ID&#125;</span> = <span class="variable">$id</span>&quot;</span>,  <span class="literal">null</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    rowsDeleted = db.delete(DBHelper.TABLE_PRODUCTS, <span class="string">&quot;<span class="subst">$&#123;DBHelper.COLUMN_ID&#125;</span> = <span class="variable">$id</span> and <span class="variable">$selection</span>&quot;</span>,  selectionArgs)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">                <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Unknown URI: <span class="subst">$&#123;uri&#125;</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        requireContext().contentResolver.notifyChange(uri, <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> rowsDeleted</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getType</span><span class="params">(uri: <span class="type">Uri</span>)</span></span>: String? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="클라이언트-앱"><a href="#클라이언트-앱" class="headerlink" title="클라이언트 앱"></a>클라이언트 앱</h1><p>이제 클라이언트 앱을 구현하겠습니다. 버튼을 누르면 서버 앱에서 데이터를 조회한 후 데이터의 개수를 토스트 메시지에 출력합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> buttonQuery: Button <span class="keyword">by</span> lazy &#123; findViewById&lt;Button&gt;(R.id.activity_main_btn_query) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        buttonQuery.setOnClickListener &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>우선 액티비티에서 <code>getContentResolver()</code>를 호출하여 컨텐트 리솔버에 접근할 수 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">buttonQuery.setOnClickListener &#123;</span><br><span class="line">    <span class="keyword">val</span> resolver = getContentResolver()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>컨텐트 리솔버는 <code>Uri</code>클래스를 사용하여 서버 앱을 탐색합니다. 따라서 다음과 같이 <code>Uri</code>클래스의 인스턴스를 생성합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">buttonQuery.setOnClickListener &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> resolver = getContentResolver()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> AUTHORITY = <span class="string">&quot;com.yologger.sqlite.ProductContentProvider&quot;</span></span><br><span class="line">    <span class="keyword">val</span> TABLE_PRODUCTS = <span class="string">&quot;products&quot;</span></span><br><span class="line">    <span class="keyword">val</span> CONTENT_URI  = Uri.parse(<span class="string">&quot;content://<span class="subst">$&#123;AUTHORITY&#125;</span>/<span class="subst">$&#123;TABLE_PRODUCTS&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>컨텐트 리솔버의 <code>query()</code>를 호출하여 데이터를 조회합니다. 이 메서드를 호출하면 컨텐트 프로바이더의 <code>query()</code>가 호출되며, 5개의 인자를 필요로 합니다.</p>
<table>
<thead>
<tr>
<th>인자</th>
<th>설명</th>
</tr>
</thead>
<tbody><tr>
<td>첫 번째 인자 <code>uri</code></td>
<td>컨텐트 프로바이더의 주소</td>
</tr>
<tr>
<td>두 번째 인자 <code>projection</code></td>
<td>어떤 열(Column)을 조회할 지 지정</td>
</tr>
<tr>
<td>세 번째 인자 <code>selection</code></td>
<td>어떤 행(Row)만 조회할 지 지정하는데 사용하며 SQL문의 WHERE절과 동일</td>
</tr>
<tr>
<td>네 번째 인자 <code>selectionArgs</code></td>
<td>어떤 행(Row)만 조회할 지 지정하는데 사용하며 SQL문의 WHERE절과 동일</td>
</tr>
<tr>
<td>다섯 번째 인자 <code>sortOrder</code></td>
<td>정렬과 관련 있으며 SQL문의 ORDER BY와 동일</td>
</tr>
</tbody></table>
<p>우리는 조건 없이 모든 데이터를 조회할 것이므로 다음과 같이 <code>query()</code>를 호출합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">buttonQuery.setOnClickListener &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> resolver = getContentResolver()</span><br><span class="line">    <span class="keyword">val</span> AUTHORITY = <span class="string">&quot;com.yologger.sqlite.ProductContentProvider&quot;</span></span><br><span class="line">    <span class="keyword">val</span> TABLE_PRODUCTS = <span class="string">&quot;products&quot;</span></span><br><span class="line">    <span class="keyword">val</span> CONTENT_URI  = Uri.parse(<span class="string">&quot;content://<span class="subst">$&#123;AUTHORITY&#125;</span>/<span class="subst">$&#123;TABLE_PRODUCTS&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> cursor = contentResolver.query(CONTENT_URI, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>Cursor</code> 객체에서 데이터의 개수를 읽어 토스트 메시지에 출력합니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">buttonQuery.setOnClickListener &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> resolver = getContentResolver()</span><br><span class="line">    <span class="keyword">val</span> AUTHORITY = <span class="string">&quot;com.yologger.sqlite.ProductContentProvider&quot;</span></span><br><span class="line">    <span class="keyword">val</span> TABLE_PRODUCTS = <span class="string">&quot;products&quot;</span></span><br><span class="line">    <span class="keyword">val</span> CONTENT_URI  = Uri.parse(<span class="string">&quot;content://<span class="subst">$&#123;AUTHORITY&#125;</span>/<span class="subst">$&#123;TABLE_PRODUCTS&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> cursor = contentResolver.query(CONTENT_URI, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">val</span> count = cursor?.count</span><br><span class="line">    Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;Count: <span class="subst">$&#123;count&#125;</span>&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="실행"><a href="#실행" class="headerlink" title="실행"></a>실행</h1><p>우선 컨텐트 프로바이더가 포함된 서버 앱을 실행합니다.<br><img src="5.png"><br>다음과 같이 데이터 한 개를 추가합니다.<br><img src="6.png"><br>컨텐트 리솔버가 포함된 클라이언트 앱을 실행합니다.<br><img src="7.png"><br>버튼을 누르면 서버 앱에서 데이터를 읽어와 토스트 메시지에 개수를 출력합니다.<br><img src="8.png"></p>
<h1 id="연락처-앱"><a href="#연락처-앱" class="headerlink" title="연락처 앱"></a>연락처 앱</h1><p>안드로이드에 내장된 <code>연락처 앱</code>에는 연락처 데이터가 저장되어 있습니다.<br><img src="9.png"><br>클라이언트 앱에서는 컨텐트 리솔버를 사용하여 연락처 데이터를 읽어올 수 있습니다. 연락처 앱에 컨텐트 프로바이더가 구현되어있기 때문입니다.</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/ko/2019/07/06/08_android/01_android_platform/190706_content_provider/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/ko/2019/07/05/08_android/01_android_platform/190705_sqlite/"
                            aria-label=": [Android] SQLite란"
                        >
                            [Android] SQLite란
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-07-05T01:00:00+09:00">
	
		    2019/07/05
    	
    </time>
    
        <span>카테고리 </span>
        
    <a class="category-link" href="/ko/categories/Android/">Android</a>, <a class="category-link" href="/ko/categories/Android/Android-Platform/">Android Platform</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <hr>
<h1 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h1><p><code>SQLite</code>는 관계형 데이터베이스 입니다. 크기가 작고 가벼워 안드로이드나 애플 iOS처럼 모바일용 데이터베이스로 많이 사용합니다.</p>
<p><code>SQLite</code>는 안드로이드 SDK에 포함되어있습니다. 따라서 별도의 설치가 필요없습니다.</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">pwd</span></span></span><br><span class="line">/Users/[user_name]/Library/Android/sdk/platform-tools</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">sqlite3</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h1 id="예제"><a href="#예제" class="headerlink" title="예제"></a>예제</h1><p>상품을 데이터베이스에 저장하는 예제를 만들어보겠습니다.<br><img src="0.png"></p>
<h3 id="1-데이터-모델-설계하기"><a href="#1-데이터-모델-설계하기" class="headerlink" title="(1) 데이터 모델 설계하기"></a>(1) 데이터 모델 설계하기</h3><p>우선 데이터 모델인 <code>Product</code>클래스를 정의합니다. <code>Product</code>클래스는 상품을 식별하는 <code>_id</code>, 상품 이름인 <code>_productName</code>, 수량인 <code>_quantity</code>를 속성으로 가지고 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span></span>(</span><br><span class="line">    <span class="keyword">var</span> _id: <span class="built_in">Int</span> = <span class="number">0</span>,</span><br><span class="line">    <span class="keyword">var</span> _productName: String,</span><br><span class="line">    <span class="keyword">var</span> _quantity: <span class="built_in">Int</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="데이터-핸들러-구현하기"><a href="#데이터-핸들러-구현하기" class="headerlink" title="데이터 핸들러 구현하기"></a>데이터 핸들러 구현하기</h3><p>데이터 핸들러는 데이터의 추가, 삭제, 변경, 조회를 담당하는 클래스입니다. <code>SQLiteOpenHelper</code>클래스의 서브 클래스로 구현됩니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">): SQLiteOpenHelper(</span><br><span class="line">    <span class="comment">// .. </span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(db: <span class="type">SQLiteDatabase</span>?)</span></span> &#123;</span><br><span class="line">        TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onUpgrade</span><span class="params">(db: <span class="type">SQLiteDatabase</span>?, oldVersion: <span class="type">Int</span>, newVersion: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>데이터베이스 이름</code>, <code>데이터베이스 버전</code>, <code>테이블 이름</code>, <code>컬럼 이름</code>을 선언합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">): SQLiteOpenHelper(</span><br><span class="line">    <span class="comment">// .. </span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> DATABASE_NAME = <span class="string">&quot;productDB.db&quot;</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> DATABASE_VERSION = <span class="number">1</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> TABLE_PRODUCTS = <span class="string">&quot;products&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> COLUMN_ID = <span class="string">&quot;id&quot;</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> COLUMN_PRODUCT_NAME = <span class="string">&quot;product_name&quot;</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> COLUMN_QUANTITY = <span class="string">&quot;quantity&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>생성자</code>를 다음과 같이 구현합니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, name: String?, factory: SQLiteDatabase.CursorFactory?, version: <span class="built_in">Int</span></span><br><span class="line">) : SQLiteOpenHelper(</span><br><span class="line">    context, DATABASE_NAME, factory, DATABASE_VERSION</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> DATABASE_NAME = <span class="string">&quot;productDB.db&quot;</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> DATABASE_VERSION = <span class="number">1</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> TABLE_PRODUCTS = <span class="string">&quot;products&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> COLUMN_ID = <span class="string">&quot;id&quot;</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> COLUMN_PRODUCT_NAME = <span class="string">&quot;product_name&quot;</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> COLUMN_QUANTITY = <span class="string">&quot;quantity&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>onCreate()</code>는 데이터베이스가 최초로 초기화될 때 호출됩니다. 여기서 product 테이블을 생성합시다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, name: String, factory: SQLiteDatabase.CursorFactory, version: <span class="built_in">Int</span></span><br><span class="line">) : SQLiteOpenHelper(</span><br><span class="line">    context, DATABASE_NAME, factory, DATABASE_VERSION</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(db: <span class="type">SQLiteDatabase</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> query = <span class="string">&quot;CREATE TABLE <span class="subst">$&#123;TABLE_PRODUCTS&#125;</span> &quot;</span> +</span><br><span class="line">                <span class="string">&quot;(&quot;</span> +</span><br><span class="line">                <span class="string">&quot;<span class="variable">$COLUMN_ID</span> INTEGER PRIMARY KEY, &quot;</span> +</span><br><span class="line">                <span class="string">&quot;<span class="variable">$COLUMN_PRODUCT_NAME</span> TEXT,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;<span class="variable">$COLUMN_QUANTITY</span> INTEGER&quot;</span> +</span><br><span class="line">                <span class="string">&quot;)&quot;</span></span><br><span class="line">        db?.execSQL(query)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이전에 사용된 것보다 더 높은 데이터베이스 버전을 가지고 핸들러가 실행될 때 <code>onUpgrade()</code>가 호출됩니다. </p>
<div class="alert warning icon"><p>여기서 말하는 <b>데이터베이스 버전</b>은 SQLite의 버전이 아닙니다. 테이블의 열이 추가되거나 데이터베이스 스키마가 변경되었을 때 버전 번호를 올려서 핸들러를 실행하면 <b>onUpgrade()</b>가 자동으로 호출됩니다. 이 때 <b>onUpgrade()</b> 안에서 원하는 SQL 작업을 수행합니다.</p>
</div>


<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, name: String, factory: SQLiteDatabase.CursorFactory, version: <span class="built_in">Int</span></span><br><span class="line">) : SQLiteOpenHelper(</span><br><span class="line">    context, DATABASE_NAME, factory, DATABASE_VERSION</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onUpgrade</span><span class="params">(db: <span class="type">SQLiteDatabase</span>?, oldVersion: <span class="type">Int</span>, newVersion: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> query = <span class="string">&quot;DROP TABLE IF EXISTS <span class="subst">$&#123;TABLE_PRODUCTS&#125;</span>&quot;</span></span><br><span class="line">        db?.execSQL(query)</span><br><span class="line">        onCreate(db)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 데이터를 추가하는 메서드를 구현합시다. 메서드의 이름은 <code>addProduct()</code> 입니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, name: String, factory: SQLiteDatabase.CursorFactory, version: <span class="built_in">Int</span></span><br><span class="line">) : SQLiteOpenHelper(</span><br><span class="line">    context, DATABASE_NAME, factory, DATABASE_VERSION</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">addProduct</span><span class="params">(product: <span class="type">Product</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> values = ContentValues()</span><br><span class="line"></span><br><span class="line">        values.put(COLUMN_PRODUCT_NAME, product._productName)</span><br><span class="line">        values.put(COLUMN_QUANTITY, product._quantity)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> db = writableDatabase</span><br><span class="line">        db.insert(TABLE_PRODUCTS, <span class="literal">null</span>, values)</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>데이터를 검색하는 메서드는 <code>findProduct()</code>입니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, name: String, factory: SQLiteDatabase.CursorFactory, version: <span class="built_in">Int</span></span><br><span class="line">) : SQLiteOpenHelper(</span><br><span class="line">    context, DATABASE_NAME, factory, DATABASE_VERSION</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">findProduct</span><span class="params">(productName: <span class="type">String</span>)</span></span>: Product? &#123;</span><br><span class="line">        <span class="keyword">val</span> query = <span class="string">&quot;SELECT * FROM <span class="subst">$&#123;TABLE_PRODUCTS&#125;</span> WHERE <span class="subst">$&#123;COLUMN_PRODUCT_NAME&#125;</span> = \&quot;<span class="subst">$&#123;productName&#125;</span>\&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> db = writableDatabase</span><br><span class="line">        <span class="keyword">val</span> cursor = db.rawQuery(query, <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> product: Product? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cursor.moveToFirst()) &#123;</span><br><span class="line">           product = Product(</span><br><span class="line">               _id = Integer.parseInt(cursor.getString(<span class="number">0</span>)),</span><br><span class="line">               _productName = cursor.getString(<span class="number">1</span>),</span><br><span class="line">               _quantity =  Integer.parseInt(cursor.getString(<span class="number">2</span>))</span><br><span class="line">           )</span><br><span class="line">            cursor.close()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            product = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        db.close()</span><br><span class="line">        <span class="keyword">return</span> product</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>데이터를 삭제하는 메서드는 <code>deleteProduct()</code>입니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, name: String?, factory: SQLiteDatabase.CursorFactory?, version: <span class="built_in">Int</span></span><br><span class="line">) : SQLiteOpenHelper(</span><br><span class="line">    context, DATABASE_NAME, factory, DATABASE_VERSION</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">deleteProduct</span><span class="params">(productName: <span class="type">String</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> query = <span class="string">&quot;SELECT * FROM <span class="subst">$&#123;TABLE_PRODUCTS&#125;</span> WHERE <span class="subst">$&#123;COLUMN_PRODUCT_NAME&#125;</span> = \&quot;<span class="subst">$&#123;productName&#125;</span>\&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> db = writableDatabase</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> cursor = db.rawQuery(query, <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cursor.moveToFirst()) &#123;</span><br><span class="line">            <span class="keyword">val</span> productId = Integer.parseInt(cursor.getString(<span class="number">0</span>))</span><br><span class="line">            db.delete(TABLE_PRODUCTS, <span class="string">&quot;<span class="variable">$COLUMN_ID</span> = <span class="subst">$&#123;productId&#125;</span>&quot;</span>, <span class="literal">null</span>)</span><br><span class="line">            cursor.close()</span><br><span class="line">            result = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        db.close()</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>전체 코드는 다음과 같습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">constructor</span></span>(</span><br><span class="line">    context: Context, name: String?, factory: SQLiteDatabase.CursorFactory?, version: <span class="built_in">Int</span></span><br><span class="line">) : SQLiteOpenHelper(</span><br><span class="line">    context, DATABASE_NAME, factory, DATABASE_VERSION</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> DATABASE_NAME = <span class="string">&quot;productDB.db&quot;</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> DATABASE_VERSION = <span class="number">1</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> TABLE_PRODUCTS = <span class="string">&quot;products&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> COLUMN_ID = <span class="string">&quot;id&quot;</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> COLUMN_PRODUCT_NAME = <span class="string">&quot;product_name&quot;</span></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> COLUMN_QUANTITY = <span class="string">&quot;quantity&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(db: <span class="type">SQLiteDatabase</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> query = <span class="string">&quot;CREATE TABLE <span class="subst">$&#123;TABLE_PRODUCTS&#125;</span> &quot;</span> +</span><br><span class="line">                <span class="string">&quot;(&quot;</span> +</span><br><span class="line">                <span class="string">&quot;<span class="variable">$COLUMN_ID</span> INTEGER PRIMARY KEY, &quot;</span> +</span><br><span class="line">                <span class="string">&quot;<span class="variable">$COLUMN_PRODUCT_NAME</span> TEXT,&quot;</span> +</span><br><span class="line">                <span class="string">&quot;<span class="variable">$COLUMN_QUANTITY</span> INTEGER&quot;</span> +</span><br><span class="line">                <span class="string">&quot;)&quot;</span></span><br><span class="line">        db?.execSQL(query)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onUpgrade</span><span class="params">(db: <span class="type">SQLiteDatabase</span>?, oldVersion: <span class="type">Int</span>, newVersion: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> query = <span class="string">&quot;DROP TABLE IF EXISTS <span class="subst">$&#123;TABLE_PRODUCTS&#125;</span>&quot;</span></span><br><span class="line">        db?.execSQL(query)</span><br><span class="line">        onCreate(db)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">addProduct</span><span class="params">(product: <span class="type">Product</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> values = ContentValues()</span><br><span class="line"></span><br><span class="line">        values.put(COLUMN_PRODUCT_NAME, product._productName)</span><br><span class="line">        values.put(COLUMN_QUANTITY, product._quantity)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> db = writableDatabase</span><br><span class="line">        db.insert(TABLE_PRODUCTS, <span class="literal">null</span>, values)</span><br><span class="line">        db.close()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">findProduct</span><span class="params">(productName: <span class="type">String</span>)</span></span>: Product? &#123;</span><br><span class="line">        <span class="keyword">val</span> query = <span class="string">&quot;SELECT * FROM <span class="subst">$&#123;TABLE_PRODUCTS&#125;</span> WHERE <span class="subst">$&#123;COLUMN_PRODUCT_NAME&#125;</span> = \&quot;<span class="subst">$&#123;productName&#125;</span>\&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> db = writableDatabase</span><br><span class="line">        <span class="keyword">val</span> cursor = db.rawQuery(query, <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> product: Product? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cursor.moveToFirst()) &#123;</span><br><span class="line">           product = Product(</span><br><span class="line">               _id = Integer.parseInt(cursor.getString(<span class="number">0</span>)),</span><br><span class="line">               _productName = cursor.getString(<span class="number">1</span>),</span><br><span class="line">               _quantity =  Integer.parseInt(cursor.getString(<span class="number">2</span>))</span><br><span class="line">           )</span><br><span class="line">            cursor.close()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            product = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        db.close()</span><br><span class="line">        <span class="keyword">return</span> product</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">deleteProduct</span><span class="params">(productName: <span class="type">String</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> query = <span class="string">&quot;SELECT * FROM <span class="subst">$&#123;TABLE_PRODUCTS&#125;</span> WHERE <span class="subst">$&#123;COLUMN_PRODUCT_NAME&#125;</span> = \&quot;<span class="subst">$&#123;productName&#125;</span>\&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> db = writableDatabase</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> cursor = db.rawQuery(query, <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cursor.moveToFirst()) &#123;</span><br><span class="line">            <span class="keyword">val</span> productId = Integer.parseInt(cursor.getString(<span class="number">0</span>))</span><br><span class="line">            Log.d(<span class="string">&quot;TEST&quot;</span>, <span class="string">&quot;productId: <span class="subst">$&#123;productId&#125;</span>&quot;</span>)</span><br><span class="line">            db.delete(TABLE_PRODUCTS, <span class="string">&quot;<span class="variable">$COLUMN_ID</span> = <span class="subst">$&#123;productId&#125;</span>&quot;</span>, <span class="literal">null</span>)</span><br><span class="line">            cursor.close()</span><br><span class="line">            result = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        db.close()</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>MainActivity</code>에서 버튼을 누르면 추가, 검색, 삭제를 하겠습니다.<br><img src="0.png"><br>레이아웃은 다음과 같습니다</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>activity_main.xml</span><ul class="tabs"><li class="tab active">xml</li></ul></figcaption><div class="tabs-content"><figure class="highlight xml" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">".MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">"36dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/activity_main_ll_top"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_main_tv_product_name"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:hint</span>=<span class="string">"Product Name"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">EditText</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_main_tv_quantity"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:hint</span>=<span class="string">"Quantity"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_main_btn_add"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"Add"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_main_btn_find"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"Find"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/activity_main_btn_remove"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"Remove"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div></figure>

<p>코드는 다음과 같습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> buttonAdd: Button <span class="keyword">by</span> lazy &#123; findViewById&lt;Button&gt;(R.id.activity_main_btn_add) &#125;</span><br><span class="line">    <span class="keyword">val</span> buttonFind: Button <span class="keyword">by</span> lazy &#123; findViewById&lt;Button&gt;(R.id.activity_main_btn_find) &#125;</span><br><span class="line">    <span class="keyword">val</span> buttonRemove: Button <span class="keyword">by</span> lazy &#123; findViewById&lt;Button&gt;(R.id.activity_main_btn_remove) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> editTextProductName: EditText <span class="keyword">by</span> lazy &#123; findViewById&lt;EditText&gt;(R.id.activity_main_tv_product_name) &#125;</span><br><span class="line">    <span class="keyword">val</span> editTextQuantity: EditText <span class="keyword">by</span> lazy &#123; findViewById&lt;EditText&gt;(R.id.activity_main_tv_quantity) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        buttonAdd.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> dbHelper = DBHelper(<span class="keyword">this</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">var</span> productName = editTextProductName.text.toString()</span><br><span class="line">            <span class="keyword">val</span> quantity = Integer.parseInt(editTextQuantity.text.toString())</span><br><span class="line">            <span class="keyword">val</span> product = Product(_productName = productName, _quantity = quantity)</span><br><span class="line">            dbHelper.addProduct(product)</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;Added.&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125;</span><br><span class="line">        buttonFind.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> dbHelper = DBHelper(<span class="keyword">this</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">var</span> productName = editTextProductName.text.toString()</span><br><span class="line">            <span class="keyword">val</span> product = dbHelper.findProduct(productName)</span><br><span class="line">            <span class="keyword">if</span> (product != <span class="literal">null</span>) &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;<span class="subst">$&#123;product.toString()&#125;</span>&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;No Such Item.&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        buttonRemove.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> dbHelper = DBHelper(<span class="keyword">this</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">var</span> result = dbHelper.deleteProduct(<span class="string">&quot;iPhone&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> (result) &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;Deleted.&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;Not Deleted. No Such Item.&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 앱을 실행하고 상품명과 수량을 입력합니다.<br><img src="1.png"><br> <code>Find 버튼</code>을 누르면 다음과 같은 토스트 메시지가 나옵니다. 아직 추가된 데이터가 없기 때문입니다.<br><img src="2.png"><br> 이제 <code>ADD 버튼</code>을 눌러 데이터를 추가합니다. 데이터가 정상적으로 추가되면 다음과 같이 토스트 메시지가 나옵니다.<br><img src="3.png"><br>다시 <code>Find 버튼</code>을 눌러봅니다. 입력한 데이터가 토스트 메시지에 출력됩니다.<br><img src="4.png"><br>이제 <code>REMOVE 버튼</code>을 누릅니다. 데이터가 삭제되고 다음과 같은 메시지가 출력됩니다.<br><img src="5.png"><br>다시 한번 <code>REMOVE 버튼</code>을 누릅니다. 데이터가 이미 삭제됐으므로 다음과 같은 메시지가 출력됩니다.<br><img src="6.png"></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/ko/2019/07/05/08_android/01_android_platform/190705_sqlite/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/ko/2019/07/04/08_android/01_android_platform/190704_service_lifecycle/"
                            aria-label=": [Android] 서비스 - (4) 서비스의 생명주기"
                        >
                            [Android] 서비스 - (4) 서비스의 생명주기
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-07-04T01:00:00+09:00">
	
		    2019/07/04
    	
    </time>
    
        <span>카테고리 </span>
        
    <a class="category-link" href="/ko/categories/Android/">Android</a>, <a class="category-link" href="/ko/categories/Android/Android-Platform/">Android Platform</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <hr>
<h1 id="서비스의-생명주기-메소드"><a href="#서비스의-생명주기-메소드" class="headerlink" title="서비스의 생명주기 메소드"></a>서비스의 생명주기 메소드</h1><p>서비스도 액티비티와 마찬가지로 생명주기 메소드가 존재합니다. 다만 서비스의 종류에 따라 호출되는 메소드가 다릅니다.</p>
<h1 id="스타트-서비스"><a href="#스타트-서비스" class="headerlink" title="스타트 서비스"></a>스타트 서비스</h1><p><code>스타트 서비스(Start Service)</code>는 <code>startService()</code>메소드를 호출하여 실행합니다.<br><img src="1.png"><br>스타트 서비스가 시작되면 다음과 같은 순서로 서비스의 생명주기 함수가 호출됩니다.</p>
<h3 id="1-onCreate"><a href="#1-onCreate" class="headerlink" title="(1) onCreate()"></a>(1) onCreate()</h3><p>서비스가 처음 생성될 때 한 번 호출됩니다. </p>
<h3 id="2-onStartCommand"><a href="#2-onStartCommand" class="headerlink" title="(2) onStartCommand()"></a>(2) onStartCommand()</h3><p>다른 액티비티가 <code>startService()</code>를 호출하면 이 메소드가 호출됩니다. 이 메소드에서는 서비스가 백그라운드에서 실행할 작업을 구현합니다. </p>
<p>스타트 서비스는 한번 실행하면 액티비티 종료와 무관하게 무한히 실행됩니다. 따라서 <code>stopSelf()</code>나 <code>stopService()</code>를 호출하면 서비스를 종료할 수 있습니다.</p>
<h3 id="3-onDestroy"><a href="#3-onDestroy" class="headerlink" title="(3) onDestroy()"></a>(3) onDestroy()</h3><p><code>stopSelf()</code>나 <code>stopService()</code>가 호출되어 서비스가 소멸할 때 호출됩니다.</p>
<hr>
<h1 id="바운드-서비스"><a href="#바운드-서비스" class="headerlink" title="바운드 서비스"></a>바운드 서비스</h1><p><code>바운드 서비스(Bound Service)</code>는 <code>bindService()</code>메소드를 호출하여 실행합니다. </p>
<p><img src="2.png"><br>바운드 서비스가 시작되면 다음과 같은 순서로 서비스의 생명주기 메소드가 호출됩니다.</p>
<h3 id="1-onCreate-1"><a href="#1-onCreate-1" class="headerlink" title="(1) onCreate()"></a>(1) onCreate()</h3><p>서비스가 처음 생성될 때 한 번 호출됩니다. </p>
<h3 id="2-onBind"><a href="#2-onBind" class="headerlink" title="(2) onBind()"></a>(2) onBind()</h3><p>액티비티에서 <code>bindService()</code>를 호출하면 이 메소드가 호출됩니다. 이 메소드는 <code>IBinder</code>객체를 반환하며, 액티비티는 이 객체를 사용하여 서비스와 통신합니다. 참고로 바운드 서비스에는 여러 액티비티가 바인딩될 수 있습니다.</p>
<h3 id="3-onUnbind"><a href="#3-onUnbind" class="headerlink" title="(3) onUnbind()"></a>(3) onUnbind()</h3><p>액티비티에서 <code>unbindService()</code>를 호출하여 서비스와의 바인딩을 끊을 수 있습니다. 이후 서비스의 <code>onUnbind()</code>메소드가 호출됩니다.</p>
<h3 id="4-onDestroy"><a href="#4-onDestroy" class="headerlink" title="(4) onDestroy()"></a>(4) onDestroy()</h3><p>서비스가 소멸할 때 호출됩니다. 바운드 서비스는 <code>stopSelf()</code>나 <code>stopService()</code>를 호출하지 않아도 됩니다. 서비스에 바인딩된 액티비티가 모두 연결을 끊으면 서비스도 소멸합니다.</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/ko/2019/07/04/08_android/01_android_platform/190704_service_lifecycle/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/ko/2019/07/03/08_android/01_android_platform/190703_bound_service/"
                            aria-label=": [Android] 서비스 - (3) 바운드 서비스(Bound Service)"
                        >
                            [Android] 서비스 - (3) 바운드 서비스(Bound Service)
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-07-03T01:00:00+09:00">
	
		    2019/07/03
    	
    </time>
    
        <span>카테고리 </span>
        
    <a class="category-link" href="/ko/categories/Android/">Android</a>, <a class="category-link" href="/ko/categories/Android/Android-Platform/">Android Platform</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <hr>
<h1 id="서비스란"><a href="#서비스란" class="headerlink" title="서비스란?"></a>서비스란?</h1><p><code>서비스(Service)</code>는 앱에서 백그라운드 작업을 수행하기 위해 등장했습니다. 액티비티와는 다르게 서비스는 별도의 레이아웃 파일이 존재하지 않습니다. 사용자에게 음악을 스트리밍 서비스하거나 파일을 다운로드하는 것은 백그라운드에서 처리하기 적절한 작업입니다.</p>
<p>서비스에는 세 가지가 있습니다.</p>
<ul>
<li>Start Service</li>
<li>Intent Service</li>
<li>Bound Service</li>
</ul>
<h1 id="바운드-서비스"><a href="#바운드-서비스" class="headerlink" title="바운드 서비스"></a>바운드 서비스</h1><p>서비스는 자신을 실행시킨 액티비티와 상호작용할 수 있습니다. 이러한 서비스를 <code>바운드 서비스(Bound Service)</code>라고 합니다. </p>
<p>예를 들어 음악 앱은 서비스를 사용하여 백그라운드에서 음악을 실행합니다. 이때 액티비티는 음악을 일시 중지하거나 다음 트랙으로 건너뛰기 위하여 서비스와 상호작용을 합니다. 이러한 경우 바운드 서비스를 사용할 수 있습니다.</p>
<h1 id="바인딩"><a href="#바인딩" class="headerlink" title="바인딩"></a>바인딩</h1><p><u>액티비티가 바운드 서비스에 연결되는 작업</u>을 <code>바인딩(Binding)</code>이라고 합니다. 바운드 서비스에서는 <code>onBind()</code>메소드를 구현합니다. 이 메소드는 서비스가 최초 생성될 때, 그리고 이후 다른 액티비티가 바운드 서비스에 바인딩할 때마다 호출됩니다. 이 메소드는 <code>IBinder</code>를 구현한 객체를 반환하며, 액티비티는 이 객체를 통해 바운드 서비스와 통신할 수 있습니다.</p>
<p>추가적으로 하나의 바운드 서비스에는 여러 컴포넌트가 바인딩할 수 있습니다.</p>
<hr>
<h1 id="1-로컬-바운드-서비스-Local-Bound-Service"><a href="#1-로컬-바운드-서비스-Local-Bound-Service" class="headerlink" title="(1) 로컬 바운드 서비스(Local Bound Service)"></a>(1) 로컬 바운드 서비스(Local Bound Service)</h1><p>액티비티와 서비스가 같은 프로세스에서 실행될 때, 이 서비스를 <code>로컬 바운드 서비스(Local Bound Service)</code>라고합니다.</p>
<p>우선 로컬 바운드 서비스를 이해하기 위해 다음과 같은 예제를 만들겠습니다.</p>
<blockquote>
<ol>
<li>액티비티에서 버튼을 클릭하면 서비스에 현재 시간을 요청합니다. </li>
<li>서비스는 현재 시간을 계산해서 액티비티에 전달합니다. </li>
<li>액티비티는 현재 시간을 전달받아 화면에 보여줍니다.</li>
</ol>
</blockquote>
<p>액티비티의 레이아웃은 다음과 같습니다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.LocalBoundServiceActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/activity_local_bound_service_btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;CURRENT TIME&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toTopOf</span>=<span class="string">&quot;@+id/activity_local_bound_service_tv&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/activity_local_bound_service_tv&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;TextView&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@+id/activity_local_bound_service_btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>Service</code>클래스를 구현하는 <code>LocalBoundService</code> 클래스를 생성합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LocalBoundService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBind</span><span class="params">(intent: <span class="type">Intent</span>)</span></span>: IBinder &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>Binder</code>클래스를 구현한 사용자 정의 클래스를 만들어야 합니다. <code>Binder</code>객체는 액티비티와 서비스가 통신하는데 사용됩니다. </p>
<p><code>Binder</code>클래스를 상속하는 <code>LocalBinder</code>를 내부 클래스 형태로 정의합시다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LocalBoundService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalBinder</span> : <span class="type">Binder</span></span>() &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>LocalBinder</code>클래스 안에 <code>LocalBoundService</code>의 참조를 반환하는 <code>getService()</code>를 구현합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LocalBoundService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalBinder</span> : <span class="type">Binder</span></span>() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getService</span><span class="params">()</span></span>: LocalBoundService = <span class="keyword">this</span><span class="symbol">@LocalBoundService</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>변수를 만들고 <code>LocalBinder</code>클래스의 인스턴스로 초기화합니다. 또한 <code>onBind()</code>함수에서 이 변수를  반환합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LocalBoundService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binder = LocalBinder()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBind</span><span class="params">(intent: <span class="type">Intent</span>)</span></span>: IBinder &#123;</span><br><span class="line">        <span class="keyword">return</span> binder</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalBinder</span> : <span class="type">Binder</span></span>() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getService</span><span class="params">()</span></span>: LocalBoundService = <span class="keyword">this</span><span class="symbol">@LocalBoundService</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>서비스에 현재 시간을 반환하는 함수를 정의합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LocalBoundService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binder = LocalBinder()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBind</span><span class="params">(intent: <span class="type">Intent</span>)</span></span>: IBinder &#123;</span><br><span class="line">        <span class="keyword">return</span> binder</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 현재 시간을 반환하는 함수</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getCurrentTime</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">var</span> dateFormat = SimpleDateFormat(<span class="string">&quot;HH:mm:ss MM/dd/yyyy&quot;</span>, Locale.US)</span><br><span class="line">        <span class="keyword">return</span> dateFormat.format(Date())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalBinder</span> : <span class="type">Binder</span></span>() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getService</span><span class="params">()</span></span>: LocalBoundService = <span class="keyword">this</span><span class="symbol">@LocalBoundService</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 액티비티에서 로컬 바운드 서비스를 사용하겠습니다. </p>
<p>액티비티는 <code>bindService()</code>를 호출하여 서비스에 바인딩합니다. 바인딩이 되면 서비스의 <code>onBind()</code>가 호출됩니다. <code>onBind()</code> 메소드는 <code>IBinder</code>클래스를 구현한 객체를 반환하는데, 액티비티에서 <code>ServiceConnection</code>클래스를 사용하여 <code>IBinder</code>를 구현한 객체를 전달받을 수 있습니다. 이후 <code>IBinder</code>클래스를 구현한 객체를 사용하여 통신을 합니다.</p>
<p>액티비티에서 <code>ServiceConnection</code>클래스의 인스턴스를 생성하고 <code>onServiceConnected()</code>메서드와 <code>onServiceDisconnected()</code>메서드를 오버라이딩 합시다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> service: LocalBoundService</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isBound = <span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> connection = <span class="keyword">object</span> : ServiceConnection &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 서비스가 바인딩 되었을 때 호출</span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onServiceConnected</span><span class="params">(name: <span class="type">ComponentName</span>?, binder: <span class="type">IBinder</span>?)</span></span> &#123;</span><br><span class="line">            <span class="keyword">var</span> binder = service <span class="keyword">as</span> LocalBoundService.LocalBinder</span><br><span class="line">            service = binder.getService()</span><br><span class="line">            isBound = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 서비스가 끊겼을 때 호출</span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onServiceDisconnected</span><span class="params">(name: <span class="type">ComponentName</span>?)</span></span> &#123;</span><br><span class="line">            isBound = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_local_bound_service)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 액티비티에서 서비스에 바인딩하겠습니다. 이때 <code>bindService()</code>메소드를 사용합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> service: LocalBoundService</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isBound = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> connection = <span class="keyword">object</span> : ServiceConnection &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 서비스가 연결되었을 때 호출</span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onServiceConnected</span><span class="params">(name: <span class="type">ComponentName</span>?, binder: <span class="type">IBinder</span>?)</span></span> &#123;</span><br><span class="line">            <span class="keyword">var</span> binder = service <span class="keyword">as</span> LocalBoundService.LocalBinder</span><br><span class="line">            service = binder.getService()</span><br><span class="line">            isBound = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 서비스가 끊겼을 때 호출</span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onServiceDisconnected</span><span class="params">(name: <span class="type">ComponentName</span>?)</span></span> &#123;</span><br><span class="line">            isBound = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_local_bound_service)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 바인딩</span></span><br><span class="line">        <span class="keyword">var</span> intent = Intent(<span class="keyword">this</span>, LocalBoundService::<span class="keyword">class</span>.java)</span><br><span class="line">        bindService(intent, connection, Context.BIND_AUTO_CREATE)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 서비스를 사용할 수 있습니다. 버튼을 누르면 서비스의 <code>getCurrentTime()</code>메소드를 호출할 수 있습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LocalBoundServiceActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> service: LocalBoundService</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        button.setOnClickListener &#123;</span><br><span class="line">            <span class="comment">// 서비스와 통신</span></span><br><span class="line">            <span class="keyword">var</span> currentTime = service.getCurrentTime()</span><br><span class="line">            textView.text = currentTime</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>액티비티가 종료되었을 때 서비스와 바인드를 끊어주는 코드도 작성합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LocalBoundServiceActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStop</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onStop()</span><br><span class="line">        unbindService(connection)</span><br><span class="line">        isBound = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="2-원격-바운드-서비스-Remote-Bound-Service"><a href="#2-원격-바운드-서비스-Remote-Bound-Service" class="headerlink" title="(2) 원격 바운드 서비스(Remote Bound Service)"></a>(2) 원격 바운드 서비스(Remote Bound Service)</h1><p>액티비티와 서비스가 다른 프로세스에서 실행될 때, 이 서비스를 <code>원격 바운드 서비스</code>라고 합니다.</p>
<p>원격 바운드 서비스를 이해하기 위해 다음과 같은 예제를 생성합시다.</p>
<blockquote>
<ol>
<li>액티비티에서 택스트를 입력하고 버튼을 누르면 원격 바운드 서비스에 메세지가 전달됩니다. </li>
<li>서비스는 이 메세지를 로그에 출력합니다.</li>
</ol>
</blockquote>
<p>우선 다음과 같이 레이아웃을 구성합니다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">EditText</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/activity_main_et&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:ems</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:inputType</span>=<span class="string">&quot;textPersonName&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:hint</span>=<span class="string">&quot;Put your message&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toTopOf</span>=<span class="string">&quot;@+id/activity_main_btn&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/activity_main_btn&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Send Message&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textAllCaps</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@+id/activity_main_et&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>이제 <code>Service</code>클래스를 구현하는 클래스를 정의합니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoteBoundService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>그리고 전달받은 메세지를 처리하는 클래스를 내부 클래스 형태로 정의합니다. 이 클래스는 <code>android.os.Handler.Handler</code>클래스를 구현하고 <code>handleMessage()</code>를 오버라이딩 합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Handler</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoteBoundService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MessageHandler</span>: <span class="type">Handler</span></span>() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">handleMessage</span><span class="params">(message: <span class="type">Message</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">val</span> <span class="keyword">data</span> = message.<span class="keyword">data</span></span><br><span class="line">            <span class="keyword">val</span> value = <span class="keyword">data</span>.getString(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">            value?.run &#123;</span><br><span class="line">                Log.d(<span class="string">&quot;TEST&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>Messenger</code>클래스의 인스턴스를 지역변수에 생성합니다. 이때 위에서 정의한 핸들러 클래스의 인스턴스를 생성자로 전달합니다. 또한 <code>onBind()</code>도 다음과 같이 구현합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Handler</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoteBoundService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> messenger = Messenger(MessageHandler())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBind</span><span class="params">(intent: <span class="type">Intent</span>)</span></span>: IBinder &#123;</span><br><span class="line">        <span class="keyword">return</span> messenger.binder</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MessageHandler</span>: <span class="type">Handler</span></span>() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">handleMessage</span><span class="params">(message: <span class="type">Message</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">val</span> <span class="keyword">data</span> = message.<span class="keyword">data</span></span><br><span class="line">            <span class="keyword">val</span> value = <span class="keyword">data</span>.getString(<span class="string">&quot;message&quot;</span>)</span><br><span class="line">            value?.run &#123;</span><br><span class="line">                println(value)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>AndroidManifest.xml</code>에서 서비스가 다른 프로세스에서 수행되도록 코드를 추가합니다. <code>android:process</code>속성을 사용합니다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">&quot;com.yologger.remote_bound_servicee&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.Remote_bound_servicee&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">service</span> <span class="attr">android:name</span>=<span class="string">&quot;.RemoteBoundService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:process</span>=<span class="string">&quot;:another_process&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>이제 액티비티에서 서비스와 바인딩합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> editText: EditText <span class="keyword">by</span> lazy &#123; findViewById&lt;EditText&gt;(R.id.activity_main_et) &#125;</span><br><span class="line">    <span class="keyword">val</span> button: Button <span class="keyword">by</span> lazy &#123; findViewById&lt;Button&gt;(R.id.activity_main_btn) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> messenger: Messenger? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">var</span> isBound = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> connection = <span class="keyword">object</span>: ServiceConnection &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onServiceConnected</span><span class="params">(name: <span class="type">ComponentName</span>?, binder: <span class="type">IBinder</span>?)</span></span> &#123;</span><br><span class="line">            messenger = Messenger(binder)</span><br><span class="line">            isBound = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onServiceDisconnected</span><span class="params">(name: <span class="type">ComponentName</span>?)</span></span> &#123;</span><br><span class="line">            messenger = <span class="literal">null</span></span><br><span class="line">            isBound = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> intent = Intent(applicationContext, RemoteBoundService::<span class="keyword">class</span>.java)</span><br><span class="line">        bindService(intent, connection, Context.BIND_AUTO_CREATE)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>마지막으로 버튼을 눌렀을 때 서비스로 메시지를 전송합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> button: Button <span class="keyword">by</span> lazy &#123; findViewById&lt;Button&gt;(R.id.activity_main_btn) &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        button.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isBound) <span class="keyword">return</span><span class="symbol">@setOnClickListener</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> message = Message.obtain()</span><br><span class="line">            <span class="keyword">var</span> bundle = Bundle()</span><br><span class="line">            bundle.putString(<span class="string">&quot;message&quot;</span>, editText.text.toString())</span><br><span class="line">            message.<span class="keyword">data</span> = bundle</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 서비스로 메시지 전송</span></span><br><span class="line">            messenger?.send(message)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/ko/2019/07/03/08_android/01_android_platform/190703_bound_service/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/ko/2019/07/02/08_android/01_android_platform/190702_intent_service/"
                            aria-label=": [Android] 서비스 - (2) 인텐트 서비스(Intent Service)"
                        >
                            [Android] 서비스 - (2) 인텐트 서비스(Intent Service)
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-07-02T01:00:00+09:00">
	
		    2019/07/02
    	
    </time>
    
        <span>카테고리 </span>
        
    <a class="category-link" href="/ko/categories/Android/">Android</a>, <a class="category-link" href="/ko/categories/Android/Android-Platform/">Android Platform</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <hr>
<h1 id="서비스란"><a href="#서비스란" class="headerlink" title="서비스란?"></a>서비스란?</h1><p><code>서비스(Service)</code>는 앱에서 백그라운드 작업을 수행하기 위해 등장했습니다. 액티비티와는 다르게 서비스는 별도의 레이아웃 파일이 존재하지 않습니다. 사용자에게 음악을 스트리밍 서비스하거나 파일을 다운로드하는 것은 백그라운드에서 처리하기 적절한 작업입니다.</p>
<p>서비스에는 세 가지가 있습니다.</p>
<ul>
<li>Start Service</li>
<li>Intent Service</li>
<li>Bound Service</li>
</ul>
<h1 id="인텐트-서비스"><a href="#인텐트-서비스" class="headerlink" title="인텐트 서비스"></a>인텐트 서비스</h1><p><code>인텐트 서비스(Intent Service)</code>를 사용하면 별도의 스레드를 생성하지 않아도 서비스가 새로운 스레드에서 실행됩니다.</p>
<p>인텐트 서비스는 <code>IntentService</code>클래스를 구현하고 <code>onHandleIntent()</code>메소드를 오버라이딩합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyIntentService</span> : <span class="type">IntentService</span></span>(<span class="string">&quot;MyIntentService&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onHandleIntent</span><span class="params">(intent: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>onHandleIntent()</code>메소드에서는 별도의 스레드에서 백그라운드로 실행할 작업을 구현합니다. 3초에 한 번씩 문자열 “This is intent service.”를 출력하겠습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyIntentService</span> : <span class="type">IntentService</span></span>(<span class="string">&quot;MyIntentService&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onHandleIntent</span><span class="params">(intent: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            Log.d(<span class="string">&quot;TEST&quot;</span>, <span class="string">&quot;This is intent service.&quot;</span>)</span><br><span class="line">            Thread.sleep(<span class="number">1000</span> * <span class="number">3</span>)     <span class="comment">// 10 seconds</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>액티비티에서는 <code>startService()</code>메소드를 사용하여 서비스를 시작합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> buttonShowToast: Button</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> buttonIntentService: Button</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        buttonShowToast = findViewById(R.id.activity_main_show_toast)</span><br><span class="line">        buttonIntentService = findViewById(R.id.activity_main_intent_service)</span><br><span class="line"></span><br><span class="line">        buttonStartService.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">var</span> intent = Intent(<span class="keyword">this</span>, MyIntentService::<span class="keyword">class</span>.java)</span><br><span class="line">            startService(intent)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        buttonShowToast.setOnClickListener &#123;</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span><span class="symbol">@MainActivity</span>, <span class="string">&quot;Toast Message&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 앱을 실행하고 버튼을 클릭합니다. 로그에 “This is intent service.”가 3초에 한번씩 출력됩니다. 또한 서비스가 실행된 상태에서 토스트 메시지 버튼을 눌러도 앱이 멈추거나 종료되지 않습니다. 인텐트 서비스는 별도의 작업 스레드를 생성하여 실행하기 때문입니다.</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/ko/2019/07/02/08_android/01_android_platform/190702_intent_service/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/ko/2019/07/01/08_android/01_android_platform/190701_start_service/"
                            aria-label=": [Android] 서비스 - (1) 스타트 서비스(Start Service)"
                        >
                            [Android] 서비스 - (1) 스타트 서비스(Start Service)
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-07-01T01:00:00+09:00">
	
		    2019/07/01
    	
    </time>
    
        <span>카테고리 </span>
        
    <a class="category-link" href="/ko/categories/Android/">Android</a>, <a class="category-link" href="/ko/categories/Android/Android-Platform/">Android Platform</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <hr>
<h1 id="서비스란"><a href="#서비스란" class="headerlink" title="서비스란?"></a>서비스란?</h1><p><code>서비스(Service)</code>는 앱에서 백그라운드 작업을 수행하기 위해 등장했습니다. 액티비티와는 다르게 서비스는 별도의 레이아웃 파일이 존재하지 않습니다. 사용자에게 음악을 스트리밍 서비스하거나 파일을 다운로드하는 것은 백그라운드에서 처리하기 적절한 작업입니다.</p>
<p>서비스에는 세 가지가 있습니다.</p>
<ul>
<li>Start Service</li>
<li>Intent Service</li>
<li>Bound Service</li>
</ul>
<h1 id="스타트-서비스"><a href="#스타트-서비스" class="headerlink" title="스타트 서비스"></a>스타트 서비스</h1><p><code>스타트 서비스(Start Service)</code>는 다른 안드로이드 컴포넌트에 의해 시작됩니다. 그리고 서비스가 중단되거나 안드로이드 운영체제에 의해 소멸될 때까지 백그라운드에서 무한정 실행됩니다. 서비스는 자신을 시작시킨 컴포넌트가 포그라운드에 있지 않거나 소멸되어도 계속 실행됩니다. 그럼 예제를 살펴보겠습니다.</p>
<p>우선 스타트 서비스는 <code>Service</code>클래스를 상속해야합니다.</p>
<figure class="highlight kotlin"><figcaption><span>MyStartService.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStartService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStartCommand</span><span class="params">(intent: <span class="type">Intent</span>?, flags: <span class="type">Int</span>, startId: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBind</span><span class="params">(intent: <span class="type">Intent</span>)</span></span>: IBinder? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>서비스는 액티비티와 유사하게 <a href="/ko/2019/07/04/08_android/01_android_platform/190704_service_lifecycle/">생명주기 함수</a>를 가지고 있습니다. 여기서 <code>onStartCommand()</code>에 백그라운드에서 수행할 작업을 구현합니다. </p>
<p>서비스에서 3초에 한번씩 문자열 “This is service”를 출력하겠습니다. <code>Thread.sleep()</code>는 현재 스레드를 특정 시간동안 중지합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStartService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStartCommand</span><span class="params">(intent: <span class="type">Intent</span>?, flags: <span class="type">Int</span>, startId: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3초에 한 번씩 This is service. 출력</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            println(<span class="string">&quot;This is service.&quot;</span>)</span><br><span class="line">            Thread.sleep(<span class="number">1000</span> * <span class="number">3</span>)     <span class="comment">// 3초 동안 현재 스래드 중지</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>MainActivity</code>는 두 개의 버튼이 있습니다. <code>Start Service</code>버튼을 누르면 서비스를 실행합니다. <code>Show ToastMessage</code>버튼을 누르면 토스트 메시지를 출력합니다.<br><img src="1.png"></p>
<p>레이아웃은 다음과 같습니다.</p>
<figure class="highlight xml"><figcaption><span>activity_main.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/activity_main_start_service&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Start Service&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textAllCaps</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toTopOf</span>=<span class="string">&quot;@+id/activity_main_show_toast&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span> <span class="attr">android:id</span>=<span class="string">&quot;@+id/activity_main_show_toast&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Show Toast Message&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textAllCaps</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@+id/activity_main_start_service&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>코드는 다음과 같습니다. 스타트 서비스를 시작할 때는 <code>startService()</code>함수를 사용합니다.</p>
<figure class="highlight kotlin"><figcaption><span>MainActivity.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> buttonShowToast: Button</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> buttonStartService: Button</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        buttonShowToast = findViewById(R.id.activity_main_show_toast)</span><br><span class="line">        buttonStartService = findViewById(R.id.activity_main_start_service)</span><br><span class="line"></span><br><span class="line">        buttonStartService.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">var</span> intent = Intent(<span class="keyword">this</span>, MyStartService::<span class="keyword">class</span>.java)</span><br><span class="line">            startService(serviceIntent)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        buttonShowToast.setOnClickListener &#123;</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span><span class="symbol">@MainActivity</span>, <span class="string">&quot;Toast Message&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 앱을 실행해보겠습니다. 버튼을 누르면 서비스가 백그라운드에서 실행되며, 로그에 3초에 한번씩 문자열 “This is service”가 출력됩니다.</p>
<p>서비스를 호출한 컴포넌트에서 <code>stopService()</code>를 호출하거나, 서비스 안에서 <code>stopSelf()</code>를 호출하여 스타트 서비스를 정지할 수 있습니다.</p>
<hr>
<h1 id="스타트-서비스의-문제점"><a href="#스타트-서비스의-문제점" class="headerlink" title="스타트 서비스의 문제점"></a>스타트 서비스의 문제점</h1><p>서비스를 실행시킨 상태에서 토스트 메시지 버튼을 눌러봅시다. 아무 응답이 없을 겁니다. 이후 다음과 같이 경고 매세지를 보여주고 앱이 종료됩니다.<br><img src="2.png"><br>안드로이드에서 사용자와의 상호작용이나 UI 변경은 <code>메인 스레드</code>에서만 이루어집니다. 그런데 스타트 서비스도 액티비티와 같은 메인 스레드에서 실행되고 있습니다. 이 때문에 메인 스레드가 3초간 중지되어있는 동안 액티비티가 사용자와의 상호작용을 할 수 없어서 앱이 종료된 것입니다.</p>
<div class="alert info"><p>위 그림처럼 다른 작업을 하느라 사용자와 상호작용할 수 없어 발생하는 에러를 <b>ANR(Android Not Responding)</b>이라고 합니다.</p>
</div>

<p>따라서 스타트 서비스를 다른 작업 스레드에서 실행해야합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStartService</span> : <span class="type">Service</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStartCommand</span><span class="params">(intent: <span class="type">Intent</span>?, flags: <span class="type">Int</span>, startId: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> runnable = Runnable &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                println(<span class="string">&quot;This is service.&quot;</span>)</span><br><span class="line">                Thread.sleep(<span class="number">1000</span> * <span class="number">3</span>)     <span class="comment">// 10 seconds</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 별도의 스레드 생성</span></span><br><span class="line">        <span class="keyword">var</span> thread = Thread(runnable)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 스레드 시작</span></span><br><span class="line">        thread.start()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 앱이 정상적으로 작동할 것입니다.</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/ko/2019/07/01/08_android/01_android_platform/190701_start_service/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/ko/2019/06/27/08_android/01_android_platform/190627_async_nonblocking/"
                            aria-label=": [Android] 비동기, 논블로킹, runOnUiThread()"
                        >
                            [Android] 비동기, 논블로킹, runOnUiThread()
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-06-27T01:00:00+09:00">
	
		    2019/06/27
    	
    </time>
    
        <span>카테고리 </span>
        
    <a class="category-link" href="/ko/categories/Android/">Android</a>, <a class="category-link" href="/ko/categories/Android/Android-Platform/">Android Platform</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <hr>
<h1 id="블로킹과-논블로킹"><a href="#블로킹과-논블로킹" class="headerlink" title="블로킹과 논블로킹"></a>블로킹과 논블로킹</h1><h3 id="1-블로킹-Blocking"><a href="#1-블로킹-Blocking" class="headerlink" title="(1) 블로킹(Blocking)"></a>(1) 블로킹(Blocking)</h3><p><code>함수 A</code>에서 <code>함수 B</code>를 호출한다고 가정합시다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">A</span><span class="params">()</span></span> &#123;</span><br><span class="line">    B()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>함수 A</code>는 <code>함수 B</code>가 끝날 때 까지 <u>기다리게 됩니다</u>. 이를 <code>함수 A</code>가 <code>블로킹(Blocking)</code>되었다고 합니다.<br><img src="1.png"><br>즉, <code>함수 A</code>는 <code>함수 B</code>가 함수가 종료되었다는 의미의 <code>return</code>를 호출하기 전까지 기다리게 됩니다.</p>
<h3 id="2-논블로킹-Non-blocking"><a href="#2-논블로킹-Non-blocking" class="headerlink" title="(2) 논블로킹(Non-blocking)"></a>(2) 논블로킹(Non-blocking)</h3><p><code>함수 A</code>에서 <code>함수 B</code>를 호출한다고 가정합시다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">A</span><span class="params">()</span></span> &#123;</span><br><span class="line">    B()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>함수 A</code>는 <code>함수 B</code>를 호출한 후 <u>기다리지 않고</u> 자신의 실행 흐름을 수행합니다.<br><img src="2.png"><br>이를 <code>함수 A</code>가 <code>논블로킹(Non-Blocking)</code>되었다고 합니다.</p>
<hr>
<h1 id="동기와-비동기"><a href="#동기와-비동기" class="headerlink" title="동기와 비동기"></a>동기와 비동기</h1><h3 id="1-동기-Synchronous"><a href="#1-동기-Synchronous" class="headerlink" title="(1) 동기(Synchronous)"></a>(1) 동기(Synchronous)</h3><p><code>함수 A</code>에서 <code>함수 B</code>를 호출한다고 가정합시다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">A</span><span class="params">()</span></span> &#123;</span><br><span class="line">    B()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>동기식 모델에서 <code>함수 A</code>는 <code>함수 B</code>가 끝날 때 까지 기다리게 됩니다. </p>
<p><img src="3.png"><br>이 때문에 <code>함수 A</code>와 <code>함수 B</code> 사이에 <u>연관성</u>있다고 하며, 두 함수가 <u>동기화 되었다고</u> 합니다.</p>
<h3 id="2-비동기-Asynchronous"><a href="#2-비동기-Asynchronous" class="headerlink" title="(2) 비동기(Asynchronous)"></a>(2) 비동기(Asynchronous)</h3><p><code>함수 A</code>에서 <code>함수 B</code>를 호출한다고 가정합시다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">A</span><span class="params">()</span></span> &#123;</span><br><span class="line">    B()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>함수 A</code>는 <code>함수 B</code>가 호출된 후 <code>함수 B</code>가 끝나든 말든 신경쓰지 않고 자신의 일을 수행합니다. </p>
<p><img src="4.png"><br>이 때문에 <code>함수 A</code>와 <code>함수 B</code> 사이에 <u>연관성</u>이 없다고 하며, 두 함수가 <u>동기화되지 않았다</u>고 합니다.</p>
<hr>
<h1 id="관점의-차이"><a href="#관점의-차이" class="headerlink" title="관점의 차이"></a>관점의 차이</h1><p>위 예제를 살펴보면 동기는 블로킹과 비슷하고 비동기와 논블로킹이 비슷하다는게 느껴지시나요? 결국 동기/비동기, 블로킹/논블로킹의 차이는 상황을 어떠한 <u>관점</u>에서 바라보는지에 있습니다. 이 때문에 컴퓨터공학에서는 보통 소프트웨어의 실행 흐름을 두 가지로 구분합니다. </p>
<ul>
<li>동기-블로킹 모델</li>
<li>비동기-논블로킹 모델</li>
</ul>
<h3 id="1-동기-블로킹-모델"><a href="#1-동기-블로킹-모델" class="headerlink" title="(1) 동기-블로킹 모델"></a>(1) 동기-블로킹 모델</h3><p><code>함수 A</code>에서 <code>함수 B</code>를 호출한다고 가정합시다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">A</span><span class="params">()</span></span> &#123;</span><br><span class="line">    B()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">B</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>동기-블로킹 모델에서 <code>함수 A</code>는 <code>함수 B</code>가 <code>return</code>을 호출하여 자신을 종료할 때 까지 기다립니다.</p>
<h3 id="2-비동기-논블로킹"><a href="#2-비동기-논블로킹" class="headerlink" title="(2) 비동기-논블로킹"></a>(2) 비동기-논블로킹</h3><p><code>함수 A</code>에서 <code>함수 B</code>를 호출한다고 가정합시다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">A</span><span class="params">()</span></span> &#123;</span><br><span class="line">    B()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">B</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>프로그래밍 언어에 따라 비동기-논블로킹 모델을 구현하는 방법이 다를 수 있습니다. Java나 Kotlin에서 비동기-논블로킹 모델을 사용한다는 것은 <a href="/ko/2019/06/26/08_android/01_android_platform/190626_thread/">멀티 스레드</a>를 사용한다는 의미입니다. Java나 Kotlin에서는 매인 스레드에서 두 개의 실행 흐름을 동시에 수행할 수 없기 때문입니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">A</span><span class="params">()</span></span> &#123;</span><br><span class="line">    B()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">B</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> runnable = Runnable &#123;</span><br><span class="line">        <span class="comment">// 다른 스레드에서 실행</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> thread = Thread(runnable)</span><br><span class="line">    thread.start()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>비동기-논블로킹 모델에서 <code>함수 A</code>는 <code>함수 B</code>가 언제 끝날 지 알 수 없습니다. 두 함수는 동기화되지 않았기 때문입니다. 따라서 보통 <code>함수 A</code>는 <code>함수 B</code>에게 <u>적절한 시점에 특정한 함수나 람다를 호출해달라고 함수 또는 람다식을 전달</u>하게 되며, 이를 <code>콜백</code>라고 합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">A</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 콜백</span></span><br><span class="line">    <span class="keyword">var</span> callback = &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 함수 B를 호출하면서 콜백을 함께 전달</span></span><br><span class="line">    B(callback)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">B</span><span class="params">(callback: () -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> runnable = Runnable &#123;</span><br><span class="line">        <span class="comment">// 적절한 시점에 콜백 호출</span></span><br><span class="line">        callback()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> thread = Thread(runnable)</span><br><span class="line">    thread.start()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="runOnUiThread"><a href="#runOnUiThread" class="headerlink" title="runOnUiThread()"></a>runOnUiThread()</h1><p>안드로이드에서 비동기-논블로킹 작업을 수행한 후, UI를 변경한다고 가정합시다. <u>안드로이드에서는 매인 스래드에서만 UI를 변경할 수 있습니다</u>. 따라서 비동기-논블로킹 작업 후 매인 스레드에서 UI를 변경하도록 코드를 수정해야합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span>: <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">a</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// 콜백 함수</span></span><br><span class="line">        <span class="keyword">var</span> callback = &#123;</span><br><span class="line">            runOnUiThread &#123;</span><br><span class="line">                <span class="comment">// UI 변경</span></span><br><span class="line">                textView.text = <span class="string">&quot;New Text&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 함수 B를 호출하면서 콜백을 함께 전달</span></span><br><span class="line">        b(callback)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">b</span><span class="params">(callback: () -&gt; ())</span></span> &#123;</span><br><span class="line">        <span class="keyword">var</span> runnable = Runnable &#123;</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">            callback()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> thread = Thread(runnable)</span><br><span class="line">        thread.start()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>AppCompatActivity</code>클래스에 정의된 <code>runOnUiThread()</code>는 인자로 전달된 람다를 매인 스레드에서 실행합니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> void runOnUiThread(Runnable action) &#123;</span><br><span class="line">        <span class="keyword">if</span> (Thread.currentThread() != mUiThread) &#123;</span><br><span class="line">            mHandler.post(action);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            action.run();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="안드로이드에서의-비동기-처리"><a href="#안드로이드에서의-비동기-처리" class="headerlink" title="안드로이드에서의 비동기 처리"></a>안드로이드에서의 비동기 처리</h1><p>안드로이드에서 비동기/논블로킹 모델을 구현하는 방법에는 여러가지가 있습니다. 대표적인 네 가지 방법은 다음과 같습니다.</p>
<ul>
<li>멀티 스레드</li>
<li>AsycnTask</li>
<li>ReactiveX (RxJava, RxKotlin)</li>
<li>Coroutine</li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/ko/2019/06/27/08_android/01_android_platform/190627_async_nonblocking/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/ko/2019/06/26/08_android/01_android_platform/190626_thread/"
                            aria-label=": [Android] 스레드(Thread)"
                        >
                            [Android] 스레드(Thread)
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-06-26T01:00:00+09:00">
	
		    2019/06/26
    	
    </time>
    
        <span>카테고리 </span>
        
    <a class="category-link" href="/ko/categories/Android/">Android</a>, <a class="category-link" href="/ko/categories/Android/Android-Platform/">Android Platform</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <hr>
<h1 id="스레드란"><a href="#스레드란" class="headerlink" title="스레드란?"></a>스레드란?</h1><p><code>스레드(Thread)</code>는 <a href="/ko/2019/06/25/08_android/01_android_platform/190625_process/">프로세스(Process)</a> 내에서 실행되는 흐름을 말합니다. 일반적으로 하나의 프로세스에는 하나의 기본 스레드가 존재합니다. 이를 <code>매인 스레드</code>라고 합니다.<br><img src="1.png"><br>이제 하나의 스레드에서 두 개의 작업을 순차적으로 수행한다고 가정해봅시다.<br><img src="2.png"><br><code>Job #1</code>은 매우 긴 시간이 소요되는 작업입니다. 반면 <code>Job #2</code>는 상대적으로 짧은 시간이 소요되는 작업입니다. 그러나 <code>Job #1</code>이 먼저 실행되었으므로 <code>Job #2</code>는 <code>Job #1</code>이 끝날 때 까지 기다려야합니다. </p>
<p>이제 스레드를 한 개 더 생성해보겠습니다.</p>
<p><img src="3.png"><br>이처럼 스레드를 여러 개 추가하여 프로세스를 병렬 처리하는 환경을 <code>멀티 스레드</code> 환경이라고 합니다. </p>
<h1 id="안드로이드에서의-스레드"><a href="#안드로이드에서의-스레드" class="headerlink" title="안드로이드에서의 스레드"></a>안드로이드에서의 스레드</h1><p>안드로이드 애플리케이션이 처음 시작되면, 안드로이드 운영체제는 하나의 프로세스와 하나의 매인 스레드를 생성합니다. 애플리케이션의 모든 컴포넌트는 매인 스레드 내에서 실행됩니다. </p>
<h1 id="매인-스레드의-역할"><a href="#매인-스레드의-역할" class="headerlink" title="매인 스레드의 역할"></a>매인 스레드의 역할</h1><p><code>매인 스레드</code>의 주된 역할은 사용자 인터페이스를 처리하는 것입니다. 이러한 이유로 안드로이드에서의 메인 스레드는 <code>UI 스레드</code>라고도 합니다. </p>
<p>매인 스레드에서 시간이 오래 걸리는 작업을 수행하면, 그 작업이 끝날 때까지 애플리캐이션 전체가 멈춘 것처럼 보이게 됩니다.</p>
<p>예제를 살펴보겠습니다. <code>TOAST</code>버튼을 누르면 토스트 매시지를 보여줍니다. 예제는 <code>STOP</code>버튼을 누르면 매인 스래드를 10초 동안 정지합니다.<br><img src="4.png"><br>코드는 다음과 같습니다.</p>
<figure class="highlight kotlin"><figcaption><span>MainActivity.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> buttonToast: Button <span class="keyword">by</span> lazy &#123; findViewById&lt;Button&gt;(R.id.activity_main_btn_toast) &#125;</span><br><span class="line">    <span class="keyword">val</span> buttonStop: Button <span class="keyword">by</span> lazy &#123; findViewById&lt;Button&gt;(R.id.activity_main_btn_stop) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        buttonToast.setOnClickListener &#123;</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;Hello World&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        buttonStop.setOnClickListener &#123;</span><br><span class="line">            Thread.sleep(<span class="number">10</span> * <span class="number">1000</span>)     <span class="comment">//  10 seconds</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>STOP</code>버튼을 누르면 안드로이드 시스템이 10초 동안 정지합니다. 이 때 <code>TOAST</code>버튼을 누르면 다음과 같은 에러가 발생합니다. 매인 스레드가 10초 동안 정지된 상태에서는 사용자 인터페이스 작업을 처리할 수 없기 때문입니다.<br><img src="5.png"></p>
<p>따라서 시간이 오래 걸리는 작업은 별도의 스래드에서 실행해야합니다. <code>Runnable</code>클래스와 <code>Thread</code>클래스를 사용하여 별도의 스레드를 생성합시다.</p>
<figure class="highlight kotlin"><figcaption><span>MainActivity.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">buttonStop.setOnClickListener &#123;</span><br><span class="line">    <span class="keyword">var</span> runnable = Runnable &#123;</span><br><span class="line">        Thread.sleep(<span class="number">10</span> * <span class="number">1000</span>)     <span class="comment">//  10 seconds</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> thread = Thread(runnable)</span><br><span class="line">    thread.start()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 <code>STOP</code>버튼을 눌러도 앱이 멈추지 않습니다. 10초 정지 작업을 별도의 스레드에서 실행하기 때문에 매인 스레드는 사용자 인터페이스를 처리할 수 있습니다.</p>
<h1 id="스레드-핸들러"><a href="#스레드-핸들러" class="headerlink" title="스레드 핸들러"></a>스레드 핸들러</h1><p>스레드와 관련해서 주의할 점이 하나 더 있습니다. 매인 스레드 외의 다른 스레드에서는 <code>사용자 인터페이스(UI) 요소</code>를 변경해서는 안된다는 것입니다. 다른 스레드에서 UI를 변경해야 하는 경우, 메인 스레드에 선언된 <code>핸들러(Handler)</code>로 메시지를 보내야 합니다.</p>
<p>우선 <code>android.os.Handler</code>클래스를 사용하여 매인 스레드에 핸들러를 정의합니다. <code>handleMessage()</code>는 다른 스레드에서 메시지를 전송했을 때 호출됩니다.</p>
<figure class="highlight kotlin"><figcaption><span>MainActivity.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Handler</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> button: Button <span class="keyword">by</span> lazy &#123; findViewById&lt;Button&gt;(R.id.activity_main_btn) &#125;</span><br><span class="line">    <span class="keyword">val</span> textView: TextView <span class="keyword">by</span> lazy &#123; findViewById&lt;TextView&gt;(R.id.activity_main_tv) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> handler = <span class="keyword">object</span>: Handler() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">handleMessage</span><span class="params">(msg: <span class="type">Message</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">super</span>.handleMessage(msg)</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>새로 생성한 스레드에서는 10초 후에 매인 스레드로 메시지를 전송합니다.</p>
<figure class="highlight kotlin"><figcaption><span>MainActivity.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> button: Button <span class="keyword">by</span> lazy &#123; findViewById&lt;Button&gt;(R.id.activity_main_btn) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        button.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">var</span> runnable = Runnable &#123;</span><br><span class="line">                Thread.sleep(<span class="number">10</span> * <span class="number">1000</span>)     <span class="comment">//  10 seconds</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">val</span> message = handler.obtainMessage()</span><br><span class="line">                <span class="keyword">val</span> bundle = Bundle()</span><br><span class="line">                bundle.putString(<span class="string">&quot;text&quot;</span>, <span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">                message.<span class="keyword">data</span> = bundle</span><br><span class="line">                handler.sendMessage(message)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> thread = Thread(runnable)</span><br><span class="line">            thread.start()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Handler</code>클래스의 <code>obtainMessage()</code>를 호출하여 메시지를 생성하비다. 이후 <code>Bundle</code> 객체를 사용하여 전송할 데이터를 추가합니다. 마지막으로 <code>sendMessage()</code>를 호출하면 메시지가 전송됩니다.</p>
<p>이제 매인 스레드에서 메시지를 수신한 후 UI를 변경하겠습니다.</p>
<figure class="highlight kotlin"><figcaption><span>MainActivity.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> handler = <span class="keyword">object</span>: Handler() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">handleMessage</span><span class="params">(msg: <span class="type">Message</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">super</span>.handleMessage(msg)</span><br><span class="line">            <span class="keyword">val</span> bundle = msg.<span class="keyword">data</span></span><br><span class="line">            <span class="keyword">val</span> string = bundle.getString(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">            string?.let &#123;</span><br><span class="line">                textView.text = it</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>버튼을 클릭하면 10초 후 텍스트 뷰가 변경됩니다.<br><img src="6.png"></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/ko/2019/06/26/08_android/01_android_platform/190626_thread/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/ko/2019/06/25/08_android/01_android_platform/190625_process/"
                            aria-label=": [Android] 프로세스(Process)"
                        >
                            [Android] 프로세스(Process)
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-06-25T01:00:00+09:00">
	
		    2019/06/25
    	
    </time>
    
        <span>카테고리 </span>
        
    <a class="category-link" href="/ko/categories/Android/">Android</a>, <a class="category-link" href="/ko/categories/Android/Android-Platform/">Android Platform</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <hr>
<h1 id="어플리케이션과-프로세스"><a href="#어플리케이션과-프로세스" class="headerlink" title="어플리케이션과 프로세스"></a>어플리케이션과 프로세스</h1><p>리눅스 기반의 운영체제인 안드로이드에서는 어플리케이션이 <code>리눅스 프로세스(Linux Process)</code>로 실행됩니다. 이때 프로세스 이름을 별도로 지정하지 않으면 <code>패키지 이름</code>을 프로세스 이름으로 사용합니다.</p>
<p>패키지 이름은 <code>AndroidManifest.xml</code>에서 확인할 수 있습니다.</p>
<figure class="highlight xml"><figcaption><span>AndroidManifest.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">&quot;com.yologger.your_project_name&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- .. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>이제 에뮬레이터나 연결된 기기에 앱을 설치합니다. 그리고 ADB를 통해 실제 프로세스 이름을 확인해봅시다.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell</span><br><span class="line"></span><br><span class="line">&gt; ps -ef | grep &quot;com.yologger.your_project_name&quot;</span><br><span class="line">u0_a289   14996   850 0 15:08:05 ?   00:00:01 com.yologger.your_project_name</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><code>&lt;application&gt;</code>태그 안에서 <code>android:process</code>속성을 사용하여 프로세스 이름을 직접 지정할 수도 있습니다.</p>
<figure class="highlight xml"><figcaption><span>AndroidManifest.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">&quot;com.yologger.your_project_name&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:process</span>=<span class="string">&quot;com.yologger.your_process_name&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>다시 프로세스 이름을 확인해봅시다.</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> adb shell</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> ps -ef | grep <span class="string">&quot;com.yologger.your_process_name&quot;</span></span>            </span><br><span class="line">u0_a289   18014   850 1 15:14:50 ?   00:00:01 com.yologger.your_process_name</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h1 id="컴포넌트와-프로세스"><a href="#컴포넌트와-프로세스" class="headerlink" title="컴포넌트와 프로세스"></a>컴포넌트와 프로세스</h1><p>하나의 애플리케이션은 여러 컴포넌트로 구성됩니다. 대부분의 컴포넌트들은 같은 프로세스에서 실행됩니다. 그러나 컴포넌트를 다른 프로세스에서 실행할 수도 있습니다. 이때는 컴포넌트에서 <code>android:process</code>속성을 사용하면 됩니다.</p>
<figure class="highlight xml"><figcaption><span>AndroidManifest.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">&quot;com.yologger.your_project&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span> <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:roundIcon</span>=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:supportsRtl</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.Your_Project&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.MainActivity&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:process</span>=<span class="string">&quot;com.yolo&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;.ActivityA&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:process</span>=<span class="string">&quot;com.yolo.process1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;.ActivityB&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:process</span>=<span class="string">&quot;com.yolo.process2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">service</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;.MyService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:process</span>=<span class="string">&quot;com.yolo.process3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>
                    
                        


                    
                    
                        <p>
                            <a
                                href="/ko/2019/06/25/08_android/01_android_platform/190625_process/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/ko/2019/06/24/08_android/01_android_platform/190624_BroadcastIntent_BroadcastReceiver/"
                            aria-label=": [Android] 브로드캐스트 인텐트와 브로드케스트 리시버"
                        >
                            [Android] 브로드캐스트 인텐트와 브로드케스트 리시버
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-06-24T01:00:00+09:00">
	
		    2019/06/24
    	
    </time>
    
        <span>카테고리 </span>
        
    <a class="category-link" href="/ko/categories/Android/">Android</a>, <a class="category-link" href="/ko/categories/Android/Android-Platform/">Android Platform</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <hr>
<h1 id="브로드캐스트-인탠트"><a href="#브로드캐스트-인탠트" class="headerlink" title="브로드캐스트 인탠트"></a>브로드캐스트 인탠트</h1><p><code>브로드캐스트 인탠트(Broadcast Intent)</code>를 사용하면 시스템의 다른 컴포넌트들에게 시스템 차원의 메시지를 전송할 수 있습니다.</p>
<h1 id="예제"><a href="#예제" class="headerlink" title="예제"></a>예제</h1><p>아래와 같이 두 개의 프로젝트를 생성합니다.</p>
<ul>
<li>broadcast_sender</li>
<li>broadcast_receiver</li>
</ul>
<h3 id="1-broadcast-sender"><a href="#1-broadcast-sender" class="headerlink" title="(1) broadcast_sender"></a>(1) broadcast_sender</h3><p>broadcast_sender 프로젝트는 브로드캐스트 인텐트를 생성하여 안드로이드 시스템에 전달합니다. 레이아웃은 다음과 같습니다.</p>
<figure class="highlight xml"><figcaption><span>activity_main.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/activity_main_button&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Send Broadcast&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>화면은 다음과 같습니다.<br><img src="1.png"></p>
<p>코드는 다음과 같습니다. 버튼을 누르면 브로드캐스트 인텐트를 생성하여 시스템에 전송합니다. 이때 <code>sendBroadcast()</code>메소드를 사용합니다.</p>
<figure class="highlight kotlin"><figcaption><span>MainActivity.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> button: Button <span class="keyword">by</span> lazy &#123; findViewById&lt;Button&gt;(R.id.activity_main_button) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        button.setOnClickListener &#123;</span><br><span class="line">            <span class="comment">// 인텐트 생성</span></span><br><span class="line">            <span class="keyword">val</span> intent = Intent()</span><br><span class="line">            <span class="comment">// 액션 설정</span></span><br><span class="line">            intent.action = <span class="string">&quot;com.yologger.broadcast_sender&quot;</span></span><br><span class="line">            <span class="comment">// 데이터 추가</span></span><br><span class="line">            intent.putExtra(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Paul&quot;</span>)</span><br><span class="line">            <span class="comment">// 브로드케스트 인텐트 전송</span></span><br><span class="line">            sendBroadcast(intent)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-broadcast-receiver"><a href="#2-broadcast-receiver" class="headerlink" title="(2) broadcast_receiver"></a>(2) broadcast_receiver</h3><p>broadcast_receiver 프로젝트는 브로드캐스트 인텐트를 수신합니다. 브로드캐스트 인텐트를 수신하려면 <code>BroadcastReceiver</code>클래스를 구현하고 <code>onReceive()</code>메소드를 오버라이딩 해야합니다. 아래 코드는 브로드케스트 인텐트를 수신하면 토스트 메시지를 출력합니다.</p>
<figure class="highlight kotlin"><figcaption><span>CustomBroadcastReceiver.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomBroadcastReceiver</span> : <span class="type">BroadcastReceiver</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceive</span><span class="params">(context: <span class="type">Context</span>, intent: <span class="type">Intent</span>)</span></span> &#123;</span><br><span class="line">        intent.action?.run &#123;</span><br><span class="line">            intent?.extras?.getString(<span class="string">&quot;name&quot;</span>).run &#123;</span><br><span class="line">                Toast.makeText(context, <span class="string">&quot;<span class="variable">$this</span>&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이제 <code>MainActivity.kt</code>에서 브로드캐스트 리시버를 등록합니다. 브로드캐스트 리시버를 등록할 때는 <code>registerReceiver()</code>메소드를 사용합니다. <code>onDestroy()</code>에서는 <code>unregisterReceiver()</code>메소드를 호출하여 브로드캐스트 리시버를 해제해야합니다.</p>
<figure class="highlight kotlin"><figcaption><span>MainActivity.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> customBroadcastReceiver: CustomBroadcastReceiver</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        customBroadcastReceiver = CustomBroadcastReceiver()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> intentFilter = IntentFilter()</span><br><span class="line">        intentFilter.addAction(Intent.ACTION_POWER_DISCONNECTED)</span><br><span class="line">        intentFilter.addAction(Intent.ACTION_POWER_CONNECTED)</span><br><span class="line">        intentFilter.addAction(<span class="string">&quot;com.yologger.broadcast_sender&quot;</span>)</span><br><span class="line"></span><br><span class="line">        registerReceiver(customBroadcastReceiver, intentFilter)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">        unregisterReceiver(customBroadcastReceiver)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이제 두 앱을 설치하고 broadcast-receiver 앱을 실행합니다. 이후 broadcast-sender 앱을 실행하고 버튼을 누르면 다음과 같이 토스트 매시지가 출력됩니다.<br><img src="2.png"></p>
<hr>
<h1 id="시스템-브로드캐스트-인텐트"><a href="#시스템-브로드캐스트-인텐트" class="headerlink" title="시스템 브로드캐스트 인텐트"></a>시스템 브로드캐스트 인텐트</h1><p>안드로이드 시스템은 전원 연결, 전원 해제, 네트워크 상태 변경 등 특정 이벤트가 발생하면 브로드캐스트 인텐트를 전송합니다. 우리는 이 <code>시스템 브로드캐스트 인텐트</code>도 수신할 수 있습니다. 아래 코드는 전원이 연결되었을 때, 전원이 해제되었을 때 시스템 인텐트를 수신하는 예제입니다.</p>
<figure class="highlight kotlin"><figcaption><span>CustomBroadcastReceiver.kt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomBroadcastReceiver</span> : <span class="type">BroadcastReceiver</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceive</span><span class="params">(context: <span class="type">Context</span>, intent: <span class="type">Intent</span>)</span></span> &#123;</span><br><span class="line">        intent.action?.run &#123;</span><br><span class="line">            <span class="keyword">when</span>(<span class="keyword">this</span>) &#123;</span><br><span class="line">                <span class="comment">// 전원이 연결되었을 때</span></span><br><span class="line">                Intent.ACTION_POWER_CONNECTED -&gt; &#123;</span><br><span class="line">                    Toast.makeText(context, <span class="string">&quot;ACTION POWER CONNECTED&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 전원이 해제되었을 때</span></span><br><span class="line">                Intent.ACTION_POWER_DISCONNECTED -&gt; &#123;</span><br><span class="line">                    Toast.makeText(context, <span class="string">&quot;ACTION POWER DISCONNECTED&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">                    intent?.extras?.getString(<span class="string">&quot;name&quot;</span>).run &#123;</span><br><span class="line">                        Toast.makeText(context, <span class="string">&quot;<span class="variable">$this</span>&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 휴대폰에 전원코드를 꼽았다 빼면 아래와 같이 토스트 메시지가 출력됩니다.<br><img src="3.png"><br><img src="4.png"></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/ko/2019/06/24/08_android/01_android_platform/190624_BroadcastIntent_BroadcastReceiver/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                댓글 공유
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
          <li class="pagination-prev">
            <a
                class="btn btn--default btn--small"
                href="/ko/archives/page/7/"
                aria-label="최근 포스트"
            >
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span>최근 포스트</span>
            </a>
          </li>
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="/ko/archives/page/9/"
                aria-label="이전 포스트"
            >
              <span>이전 포스트</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">page 8 of 23</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 yologger. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">yologger</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/ko/assets/images/background.png');"></div>
        <!--SCRIPTS-->

<script src="/ko/assets/js/script-s1qf4dycbfqqmgvjljlv3c81jri2dhkbfsbrr18gdsntpulta4iextu4bozl.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
